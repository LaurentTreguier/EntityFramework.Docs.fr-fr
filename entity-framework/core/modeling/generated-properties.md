---
title: Valeurs générées-EF Core
description: Comment configurer la génération de valeurs pour les propriétés lors de l’utilisation de Entity Framework Core
author: AndriySvyryd
ms.date: 11/06/2019
uid: core/modeling/generated-properties
ms.openlocfilehash: 347cedbf5fdebc985d75c6cad3c28f17d1344993
ms.sourcegitcommit: f3512e3a98e685a3ba409c1d0157ce85cc390cf4
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/10/2020
ms.locfileid: "94429622"
---
# <a name="generated-values"></a><span data-ttu-id="83356-103">Valeurs générées</span><span class="sxs-lookup"><span data-stu-id="83356-103">Generated Values</span></span>

## <a name="value-generation-patterns"></a><span data-ttu-id="83356-104">Modèles de génération de valeur</span><span class="sxs-lookup"><span data-stu-id="83356-104">Value generation patterns</span></span>

<span data-ttu-id="83356-105">Il existe trois modèles de génération de valeur qui peuvent être utilisés pour les propriétés :</span><span class="sxs-lookup"><span data-stu-id="83356-105">There are three value generation patterns that can be used for properties:</span></span>

* <span data-ttu-id="83356-106">Aucune génération de valeur</span><span class="sxs-lookup"><span data-stu-id="83356-106">No value generation</span></span>
* <span data-ttu-id="83356-107">Valeur générée lors de l’ajout</span><span class="sxs-lookup"><span data-stu-id="83356-107">Value generated on add</span></span>
* <span data-ttu-id="83356-108">Valeur générée lors de l’ajout ou de la mise à jour</span><span class="sxs-lookup"><span data-stu-id="83356-108">Value generated on add or update</span></span>

### <a name="no-value-generation"></a><span data-ttu-id="83356-109">Aucune génération de valeur</span><span class="sxs-lookup"><span data-stu-id="83356-109">No value generation</span></span>

<span data-ttu-id="83356-110">Aucune génération de valeur ne signifie que vous fournissez toujours une valeur valide à enregistrer dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="83356-110">No value generation means that you will always supply a valid value to be saved to the database.</span></span> <span data-ttu-id="83356-111">Cette valeur valide doit être assignée aux nouvelles entités avant d’être ajoutées au contexte.</span><span class="sxs-lookup"><span data-stu-id="83356-111">This valid value must be assigned to new entities before they are added to the context.</span></span>

### <a name="value-generated-on-add"></a><span data-ttu-id="83356-112">Valeur générée lors de l’ajout</span><span class="sxs-lookup"><span data-stu-id="83356-112">Value generated on add</span></span>

<span data-ttu-id="83356-113">La valeur générée lors de l’ajout signifie qu’une valeur est générée pour les nouvelles entités.</span><span class="sxs-lookup"><span data-stu-id="83356-113">Value generated on add means that a value is generated for new entities.</span></span>

<span data-ttu-id="83356-114">Selon le fournisseur de base de données utilisé, les valeurs peuvent être générées côté client par EF ou dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="83356-114">Depending on the database provider being used, values may be generated client side by EF or in the database.</span></span> <span data-ttu-id="83356-115">Si la valeur est générée par la base de données, EF peut affecter une valeur temporaire lorsque vous ajoutez l’entité au contexte.</span><span class="sxs-lookup"><span data-stu-id="83356-115">If the value is generated by the database, then EF may assign a temporary value when you add the entity to the context.</span></span> <span data-ttu-id="83356-116">Cette valeur temporaire sera ensuite remplacée par la valeur générée par la base de données pendant `SaveChanges()` .</span><span class="sxs-lookup"><span data-stu-id="83356-116">This temporary value will then be replaced by the database generated value during `SaveChanges()`.</span></span>

<span data-ttu-id="83356-117">Si vous ajoutez une entité au contexte qui a une valeur affectée à la propriété, EF tente d’insérer cette valeur au lieu d’en générer une nouvelle.</span><span class="sxs-lookup"><span data-stu-id="83356-117">If you add an entity to the context that has a value assigned to the property, then EF will attempt to insert that value rather than generating a new one.</span></span> <span data-ttu-id="83356-118">Une propriété est considérée comme ayant une valeur affectée si la valeur CLR par défaut n’est pas affectée ( `null` pour, pour, pour, `string` `0` `int` `Guid.Empty` `Guid` etc.).</span><span class="sxs-lookup"><span data-stu-id="83356-118">A property is considered to have a value assigned if it is not assigned the CLR default value (`null` for `string`, `0` for `int`, `Guid.Empty` for `Guid`, etc.).</span></span> <span data-ttu-id="83356-119">Pour plus d’informations, consultez [valeurs explicites pour les propriétés générées](xref:core/saving/explicit-values-generated-properties).</span><span class="sxs-lookup"><span data-stu-id="83356-119">For more information, see [Explicit values for generated properties](xref:core/saving/explicit-values-generated-properties).</span></span>

> [!WARNING]
> <span data-ttu-id="83356-120">La façon dont la valeur est générée pour les entités ajoutées dépend du fournisseur de base de données utilisé.</span><span class="sxs-lookup"><span data-stu-id="83356-120">How the value is generated for added entities will depend on the database provider being used.</span></span> <span data-ttu-id="83356-121">Les fournisseurs de bases de données peuvent configurer automatiquement la génération de valeur pour certains types de propriété, mais d’autres peuvent vous obliger à configurer manuellement la manière dont la valeur est générée.</span><span class="sxs-lookup"><span data-stu-id="83356-121">Database providers may automatically set up value generation for some property types, but others may require you to manually set up how the value is generated.</span></span>
>
> <span data-ttu-id="83356-122">Par exemple, lors de l’utilisation de SQL Server, les valeurs sont générées automatiquement pour `GUID` les propriétés (à l’aide de l’algorithme de GUID SQL Server séquentiel).</span><span class="sxs-lookup"><span data-stu-id="83356-122">For example, when using SQL Server, values will be automatically generated for `GUID` properties (using the SQL Server sequential GUID algorithm).</span></span> <span data-ttu-id="83356-123">Toutefois, si vous spécifiez qu’une `DateTime` propriété est générée lors de l’ajout, vous devez configurer un moyen de générer les valeurs.</span><span class="sxs-lookup"><span data-stu-id="83356-123">However, if you specify that a `DateTime` property is generated on add, then you must set up a way for the values to be generated.</span></span> <span data-ttu-id="83356-124">Pour ce faire, vous pouvez configurer une valeur par défaut de `GETDATE()` , voir [valeurs par défaut](#default-values).</span><span class="sxs-lookup"><span data-stu-id="83356-124">One way to do this, is to configure a default value of `GETDATE()`, see [Default Values](#default-values).</span></span>

### <a name="value-generated-on-add-or-update"></a><span data-ttu-id="83356-125">Valeur générée lors de l’ajout ou de la mise à jour</span><span class="sxs-lookup"><span data-stu-id="83356-125">Value generated on add or update</span></span>

<span data-ttu-id="83356-126">La valeur générée à l’ajout ou à la mise à jour signifie qu’une nouvelle valeur est générée chaque fois que l’enregistrement est enregistré (Insert ou Update).</span><span class="sxs-lookup"><span data-stu-id="83356-126">Value generated on add or update means that a new value is generated every time the record is saved (insert or update).</span></span>

<span data-ttu-id="83356-127">Comme `value generated on add` , si vous spécifiez une valeur pour la propriété sur une instance nouvellement ajoutée d’une entité, cette valeur est insérée au lieu d’une valeur générée.</span><span class="sxs-lookup"><span data-stu-id="83356-127">Like `value generated on add`, if you specify a value for the property on a newly added instance of an entity, that value will be inserted rather than a value being generated.</span></span> <span data-ttu-id="83356-128">Il est également possible de définir une valeur explicite lors de la mise à jour.</span><span class="sxs-lookup"><span data-stu-id="83356-128">It is also possible to set an explicit value when updating.</span></span> <span data-ttu-id="83356-129">Pour plus d’informations, consultez [valeurs explicites pour les propriétés générées](xref:core/saving/explicit-values-generated-properties).</span><span class="sxs-lookup"><span data-stu-id="83356-129">For more information, see [Explicit values for generated properties](xref:core/saving/explicit-values-generated-properties).</span></span>

> [!WARNING]
> <span data-ttu-id="83356-130">La façon dont la valeur est générée pour les entités ajoutées et mises à jour dépend du fournisseur de base de données utilisé.</span><span class="sxs-lookup"><span data-stu-id="83356-130">How the value is generated for added and updated entities will depend on the database provider being used.</span></span> <span data-ttu-id="83356-131">Les fournisseurs de bases de données peuvent configurer automatiquement la génération de valeur pour certains types de propriété, tandis que d’autres vous obligent à configurer manuellement la manière dont la valeur est générée.</span><span class="sxs-lookup"><span data-stu-id="83356-131">Database providers may automatically set up value generation for some property types, while others will require you to manually set up how the value is generated.</span></span>
>
> <span data-ttu-id="83356-132">Par exemple, lors de l’utilisation de SQL Server, les `byte[]` propriétés définies comme générées lors de l’ajout ou de la mise à jour et marquées comme jetons d’accès concurrentiel sont configurées avec le type de données, de `rowversion` sorte que les valeurs sont générées dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="83356-132">For example, when using SQL Server, `byte[]` properties that are set as generated on add or update and marked as concurrency tokens, will be set up with the `rowversion` data type - so that values will be generated in the database.</span></span> <span data-ttu-id="83356-133">Toutefois, si vous spécifiez qu’une `DateTime` propriété est générée lors de l’ajout ou de la mise à jour, vous devez configurer un moyen de générer les valeurs.</span><span class="sxs-lookup"><span data-stu-id="83356-133">However, if you specify that a `DateTime` property is generated on add or update, then you must set up a way for the values to be generated.</span></span> <span data-ttu-id="83356-134">Pour ce faire, vous pouvez configurer une valeur par défaut `GETDATE()` (voir les [valeurs par défaut](#default-values)) pour générer des valeurs pour les nouvelles lignes.</span><span class="sxs-lookup"><span data-stu-id="83356-134">One way to do this, is to configure a default value of `GETDATE()` (see [Default Values](#default-values)) to generate values for new rows.</span></span> <span data-ttu-id="83356-135">Vous pouvez ensuite utiliser un déclencheur de base de données pour générer des valeurs lors des mises à jour (par exemple, le déclencheur suivant).</span><span class="sxs-lookup"><span data-stu-id="83356-135">You could then use a database trigger to generate values during updates (such as the following example trigger).</span></span>
>
> [!code-sql[Main](../../../samples/core/Modeling/FluentAPI/ValueGeneratedOnAddOrUpdate.sql)]

## <a name="value-generated-on-add"></a><span data-ttu-id="83356-136">Valeur générée lors de l’ajout</span><span class="sxs-lookup"><span data-stu-id="83356-136">Value generated on add</span></span>

<span data-ttu-id="83356-137">Par Convention, les clés primaires non composites de type short, int, long ou GUID sont configurées pour avoir des valeurs générées pour les entités insérées, si une valeur n’est pas fournie par l’application.</span><span class="sxs-lookup"><span data-stu-id="83356-137">By convention, non-composite primary keys of type short, int, long, or Guid are set up to have values generated for inserted entities, if a value isn't provided by the application.</span></span> <span data-ttu-id="83356-138">Votre fournisseur de base de données prend généralement en charge la configuration requise ; par exemple, une clé primaire numérique dans SQL Server est automatiquement configurée pour être une colonne d’identité.</span><span class="sxs-lookup"><span data-stu-id="83356-138">Your database provider typically takes care of the necessary configuration; for example, a numeric primary key in SQL Server is automatically set up to be an IDENTITY column.</span></span>

<span data-ttu-id="83356-139">Vous pouvez configurer n’importe quelle propriété pour que sa valeur soit générée pour les entités insérées comme suit :</span><span class="sxs-lookup"><span data-stu-id="83356-139">You can configure any property to have its value generated for inserted entities as follows:</span></span>

### <a name="data-annotations"></a>[<span data-ttu-id="83356-140">Annotations de données</span><span class="sxs-lookup"><span data-stu-id="83356-140">Data Annotations</span></span>](#tab/data-annotations)

[!code-csharp[Main](../../../samples/core/Modeling/DataAnnotations/ValueGeneratedOnAdd.cs?name=ValueGeneratedOnAdd&highlight=5)]

### <a name="fluent-api"></a>[<span data-ttu-id="83356-141">API Fluent</span><span class="sxs-lookup"><span data-stu-id="83356-141">Fluent API</span></span>](#tab/fluent-api)

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/ValueGeneratedOnAdd.cs?name=ValueGeneratedOnAdd&highlight=5)]

***

> [!WARNING]
> <span data-ttu-id="83356-142">Cela permet simplement à EF de savoir que les valeurs sont générées pour les entités ajoutées. cela ne garantit pas qu’EF configure le mécanisme réel pour générer des valeurs.</span><span class="sxs-lookup"><span data-stu-id="83356-142">This just lets EF know that values are generated for added entities, it does not guarantee that EF will set up the actual mechanism to generate values.</span></span> <span data-ttu-id="83356-143">Pour plus d’informations, consultez la section [valeur générée sur l’ajout](#value-generated-on-add) .</span><span class="sxs-lookup"><span data-stu-id="83356-143">See [Value generated on add](#value-generated-on-add) section for more details.</span></span>

### <a name="default-values"></a><span data-ttu-id="83356-144">Valeurs par défaut</span><span class="sxs-lookup"><span data-stu-id="83356-144">Default values</span></span>

<span data-ttu-id="83356-145">Sur les bases de données relationnelles, une colonne peut être configurée avec une valeur par défaut ; Si une ligne est insérée sans valeur pour cette colonne, la valeur par défaut est utilisée.</span><span class="sxs-lookup"><span data-stu-id="83356-145">On relational databases, a column can be configured with a default value; if a row is inserted without a value for that column, the default value will be used.</span></span>

<span data-ttu-id="83356-146">Vous pouvez configurer une valeur par défaut sur une propriété :</span><span class="sxs-lookup"><span data-stu-id="83356-146">You can configure a default value on a property:</span></span>

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/DefaultValue.cs?name=DefaultValue&highlight=5)]

<span data-ttu-id="83356-147">Vous pouvez également spécifier un fragment SQL utilisé pour calculer la valeur par défaut :</span><span class="sxs-lookup"><span data-stu-id="83356-147">You can also specify a SQL fragment that is used to calculate the default value:</span></span>

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/DefaultValueSql.cs?name=DefaultValueSql&highlight=5)]

<span data-ttu-id="83356-148">La spécification d’une valeur par défaut configure implicitement la propriété en tant que valeur générée lors de l’ajout.</span><span class="sxs-lookup"><span data-stu-id="83356-148">Specifying a default value will implicitly configure the property as value generated on add.</span></span>

## <a name="value-generated-on-add-or-update"></a><span data-ttu-id="83356-149">Valeur générée lors de l’ajout ou de la mise à jour</span><span class="sxs-lookup"><span data-stu-id="83356-149">Value generated on add or update</span></span>

### <a name="data-annotations"></a>[<span data-ttu-id="83356-150">Annotations de données</span><span class="sxs-lookup"><span data-stu-id="83356-150">Data Annotations</span></span>](#tab/data-annotations)

[!code-csharp[Main](../../../samples/core/Modeling/DataAnnotations/ValueGeneratedOnAddOrUpdate.cs?name=ValueGeneratedOnAddOrUpdate&highlight=5)]

### <a name="fluent-api"></a>[<span data-ttu-id="83356-151">API Fluent</span><span class="sxs-lookup"><span data-stu-id="83356-151">Fluent API</span></span>](#tab/fluent-api)

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/ValueGeneratedOnAddOrUpdate.cs?name=ValueGeneratedOnAddOrUpdate&highlight=5)]

<span data-ttu-id="83356-152">\*\*_</span><span class="sxs-lookup"><span data-stu-id="83356-152">\*\*_</span></span>

> [!WARNING]
> <span data-ttu-id="83356-153">Cela permet simplement à EF de savoir que les valeurs sont générées pour les entités ajoutées ou mises à jour, mais elle ne garantit pas qu’EF configure le mécanisme réel pour générer des valeurs.</span><span class="sxs-lookup"><span data-stu-id="83356-153">This just lets EF know that values are generated for added or updated entities, it does not guarantee that EF will set up the actual mechanism to generate values.</span></span> <span data-ttu-id="83356-154">Pour plus d’informations, consultez la section [valeur générée dans la section Ajouter ou mettre à jour](#value-generated-on-add-or-update) .</span><span class="sxs-lookup"><span data-stu-id="83356-154">See [Value generated on add or update](#value-generated-on-add-or-update) section for more details.</span></span>

### <a name="computed-columns"></a><span data-ttu-id="83356-155">Colonnes calculées</span><span class="sxs-lookup"><span data-stu-id="83356-155">Computed columns</span></span>

<span data-ttu-id="83356-156">Sur la plupart des bases de données relationnelles, une colonne peut être configurée de manière à ce que sa valeur soit calculée dans la base de données, généralement avec une expression faisant référence à d’autres colonnes :</span><span class="sxs-lookup"><span data-stu-id="83356-156">On most relational databases, a column can be configured to have its value computed in the database, typically with an expression referring to other columns:</span></span>

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/ComputedColumn.cs?name=DefaultComputedColumn)]

<span data-ttu-id="83356-157">L’instruction ci-dessus crée une colonne calculée _virtual \*, dont la valeur est calculée chaque fois qu’elle est extraite de la base de données.</span><span class="sxs-lookup"><span data-stu-id="83356-157">The above creates a _virtual\* computed column, whose value is computed every time it is fetched from the database.</span></span> <span data-ttu-id="83356-158">Vous pouvez également spécifier qu’une colonne calculée soit *stockée* (parfois appelée *PERSISTED* ), ce qui signifie qu’elle est calculée à chaque mise à jour de la ligne et qu’elle est stockée sur le disque avec les colonnes normales :</span><span class="sxs-lookup"><span data-stu-id="83356-158">You may also specify that a computed column be *stored* (sometimes called *persisted* ), meaning that it is computed on every update of the row, and is stored on disk alongside regular columns:</span></span>

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/ComputedColumn.cs?name=StoredComputedColumn)]

> [!NOTE]
> <span data-ttu-id="83356-159">La prise en charge de la création de colonnes calculées stockées a été ajoutée dans EF Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="83356-159">Support for creating stored computed columns was added in EF Core 5.0.</span></span>

## <a name="no-value-generation"></a><span data-ttu-id="83356-160">Aucune génération de valeur</span><span class="sxs-lookup"><span data-stu-id="83356-160">No value generation</span></span>

<span data-ttu-id="83356-161">La désactivation de la génération de valeur sur une propriété est généralement nécessaire si une convention la configure pour la génération de valeur.</span><span class="sxs-lookup"><span data-stu-id="83356-161">Disabling value generation on a property is typically necessary if a convention configures it for value generation.</span></span> <span data-ttu-id="83356-162">Par exemple, si vous avez une clé primaire de type int, elle sera définie implicitement comme valeur générée lors de l’ajout. vous pouvez désactiver ce code à l’aide des éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="83356-162">For example, if you have a primary key of type int, it will be implicitly set configured as value generated on add; you can disable this via the following:</span></span>

### <a name="data-annotations"></a>[<span data-ttu-id="83356-163">Annotations de données</span><span class="sxs-lookup"><span data-stu-id="83356-163">Data Annotations</span></span>](#tab/data-annotations)

[!code-csharp[Main](../../../samples/core/Modeling/DataAnnotations/ValueGeneratedNever.cs?name=ValueGeneratedNever&highlight=3)]

### <a name="fluent-api"></a>[<span data-ttu-id="83356-164">API Fluent</span><span class="sxs-lookup"><span data-stu-id="83356-164">Fluent API</span></span>](#tab/fluent-api)

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/ValueGeneratedNever.cs?name=ValueGeneratedNever&highlight=5)]

***
