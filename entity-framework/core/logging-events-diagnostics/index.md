---
title: Vue d’ensemble de la journalisation et de l’interception-EF Core
description: Vue d’ensemble de la journalisation, des événements, des intercepteurs et des diagnostics pour EF Core
author: ajcvickers
ms.date: 10/01/2020
uid: core/logging-events-diagnostics/index
ms.openlocfilehash: fdf536dc6ec15e6e520d574b14527a4e7a7b1d72
ms.sourcegitcommit: f3512e3a98e685a3ba409c1d0157ce85cc390cf4
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/10/2020
ms.locfileid: "94431528"
---
# <a name="overview-of-logging-and-interception"></a><span data-ttu-id="ff27a-103">Vue d’ensemble de la journalisation et de l’interception</span><span class="sxs-lookup"><span data-stu-id="ff27a-103">Overview of Logging and Interception</span></span>

<span data-ttu-id="ff27a-104">Entity Framework Core (EF Core) contient plusieurs mécanismes permettant de générer des journaux, de répondre aux événements et d’obtenir des Diagnostics.</span><span class="sxs-lookup"><span data-stu-id="ff27a-104">Entity Framework Core (EF Core) contains several mechanisms for generating logs, responding to events, and obtaining diagnostics.</span></span> <span data-ttu-id="ff27a-105">Chacune d’elles est adaptée à différentes situations, et il est important de sélectionner le mécanisme le mieux adapté à la tâche, même lorsque plusieurs mécanismes peuvent fonctionner.</span><span class="sxs-lookup"><span data-stu-id="ff27a-105">Each of these is tailored to different situations, and it is important to select the best mechanism for the task in hand, even when multiple mechanisms could work.</span></span> <span data-ttu-id="ff27a-106">Par exemple, un intercepteur de base de données peut être utilisé pour journaliser SQL, mais il est mieux géré par l’un des mécanismes adaptés à la journalisation.</span><span class="sxs-lookup"><span data-stu-id="ff27a-106">For example, a database interceptor could be used to log SQL, but this is better handled by one of the mechanisms tailored to logging.</span></span> <span data-ttu-id="ff27a-107">Cette page présente une vue d’ensemble de chacun de ces mécanismes et décrit les cas d’utilisation de chacun d’entre eux.</span><span class="sxs-lookup"><span data-stu-id="ff27a-107">This page presents an overview of each of these mechanisms and describes when each should be used.</span></span>

## <a name="quick-reference"></a><span data-ttu-id="ff27a-108">Aide-mémoire</span><span class="sxs-lookup"><span data-stu-id="ff27a-108">Quick reference</span></span>

<span data-ttu-id="ff27a-109">Le tableau ci-dessous fournit une référence rapide pour les différences entre les mécanismes décrits ici.</span><span class="sxs-lookup"><span data-stu-id="ff27a-109">The table below provides a quick reference for the differences between the mechanisms described here.</span></span>

| <span data-ttu-id="ff27a-110">Mechanism</span><span class="sxs-lookup"><span data-stu-id="ff27a-110">Mechanism</span></span> |  <span data-ttu-id="ff27a-111">Async</span><span class="sxs-lookup"><span data-stu-id="ff27a-111">Async</span></span> | <span data-ttu-id="ff27a-112">Étendue</span><span class="sxs-lookup"><span data-stu-id="ff27a-112">Scope</span></span> | <span data-ttu-id="ff27a-113">Inscrit</span><span class="sxs-lookup"><span data-stu-id="ff27a-113">Registered</span></span> | <span data-ttu-id="ff27a-114">Usage prévu</span><span class="sxs-lookup"><span data-stu-id="ff27a-114">Intended use</span></span>
|:----------|--------|-------|------------|-------------
| <span data-ttu-id="ff27a-115">Journalisation simple</span><span class="sxs-lookup"><span data-stu-id="ff27a-115">Simple Logging</span></span> | <span data-ttu-id="ff27a-116">Non</span><span class="sxs-lookup"><span data-stu-id="ff27a-116">No</span></span> | <span data-ttu-id="ff27a-117">Par contexte</span><span class="sxs-lookup"><span data-stu-id="ff27a-117">Per context</span></span> | <span data-ttu-id="ff27a-118">Configuration du contexte</span><span class="sxs-lookup"><span data-stu-id="ff27a-118">Context configuration</span></span> | <span data-ttu-id="ff27a-119">Journalisation au moment du développement</span><span class="sxs-lookup"><span data-stu-id="ff27a-119">Development-time logging</span></span>
| <span data-ttu-id="ff27a-120">Microsoft.Extensions.Logging</span><span class="sxs-lookup"><span data-stu-id="ff27a-120">Microsoft.Extensions.Logging</span></span> | <span data-ttu-id="ff27a-121">Non</span><span class="sxs-lookup"><span data-stu-id="ff27a-121">No</span></span> | <span data-ttu-id="ff27a-122">Par contexte \*</span><span class="sxs-lookup"><span data-stu-id="ff27a-122">Per context\*</span></span> | <span data-ttu-id="ff27a-123">D.I.</span><span class="sxs-lookup"><span data-stu-id="ff27a-123">D.I.</span></span> <span data-ttu-id="ff27a-124">configuration du contexte ou</span><span class="sxs-lookup"><span data-stu-id="ff27a-124">or context configuration</span></span> | <span data-ttu-id="ff27a-125">Journalisation de la production</span><span class="sxs-lookup"><span data-stu-id="ff27a-125">Production logging</span></span>
| <span data-ttu-id="ff27a-126">Événements</span><span class="sxs-lookup"><span data-stu-id="ff27a-126">Events</span></span> | <span data-ttu-id="ff27a-127">Non</span><span class="sxs-lookup"><span data-stu-id="ff27a-127">No</span></span> | <span data-ttu-id="ff27a-128">Par contexte</span><span class="sxs-lookup"><span data-stu-id="ff27a-128">Per context</span></span> | <span data-ttu-id="ff27a-129">N'importe quand</span><span class="sxs-lookup"><span data-stu-id="ff27a-129">Any time</span></span> | <span data-ttu-id="ff27a-130">Réagir aux événements EF</span><span class="sxs-lookup"><span data-stu-id="ff27a-130">Reacting to EF events</span></span>
| <span data-ttu-id="ff27a-131">Intercepteurs</span><span class="sxs-lookup"><span data-stu-id="ff27a-131">Interceptors</span></span> | <span data-ttu-id="ff27a-132">Oui</span><span class="sxs-lookup"><span data-stu-id="ff27a-132">Yes</span></span> | <span data-ttu-id="ff27a-133">Par contexte</span><span class="sxs-lookup"><span data-stu-id="ff27a-133">Per context</span></span> | <span data-ttu-id="ff27a-134">Configuration du contexte</span><span class="sxs-lookup"><span data-stu-id="ff27a-134">Context configuration</span></span> | <span data-ttu-id="ff27a-135">Manipulation des opérations EF</span><span class="sxs-lookup"><span data-stu-id="ff27a-135">Manipulating EF operations</span></span>
| <span data-ttu-id="ff27a-136">Écouteurs de diagnostic</span><span class="sxs-lookup"><span data-stu-id="ff27a-136">Diagnostics listeners</span></span> | <span data-ttu-id="ff27a-137">Non</span><span class="sxs-lookup"><span data-stu-id="ff27a-137">No</span></span> | <span data-ttu-id="ff27a-138">Process</span><span class="sxs-lookup"><span data-stu-id="ff27a-138">Process</span></span> | <span data-ttu-id="ff27a-139">Globalement</span><span class="sxs-lookup"><span data-stu-id="ff27a-139">Globally</span></span> | <span data-ttu-id="ff27a-140">Diagnostic d'application</span><span class="sxs-lookup"><span data-stu-id="ff27a-140">Application diagnostics</span></span>

<span data-ttu-id="ff27a-141">\* `Microsoft.Extensions.Logging` Est généralement configuré par application via l’injection de dépendances, mais au niveau d’EF, chaque contexte _peut_ être configuré avec un journal différent si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="ff27a-141">\*Typically `Microsoft.Extensions.Logging` is configured per-application via dependency injection However, at the EF level, each context _can_ be configured with a different logger if needed.</span></span>

## <a name="simple-logging"></a><span data-ttu-id="ff27a-142">Journalisation simple</span><span class="sxs-lookup"><span data-stu-id="ff27a-142">Simple logging</span></span>

> [!NOTE]
> <span data-ttu-id="ff27a-143">Cette fonctionnalité a été ajoutée dans EF Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="ff27a-143">This feature was added in EF Core 5.0.</span></span>

<span data-ttu-id="ff27a-144">Les journaux de EF Core sont accessibles à partir de n’importe quel type d’application par le biais de l’utilisation de [LogTo](https://github.com/dotnet/efcore/blob/ec3df8fd7e4ea4ebeebfa747619cef37b23ab2c6/src/EFCore/DbContextOptionsBuilder.cs#L135)</span><span class="sxs-lookup"><span data-stu-id="ff27a-144">EF Core logs can be accessed from any type of application through the use of [LogTo](https://github.com/dotnet/efcore/blob/ec3df8fd7e4ea4ebeebfa747619cef37b23ab2c6/src/EFCore/DbContextOptionsBuilder.cs#L135)</span></span> <!-- Issue #2748 <xref:Microsoft.EntityFrameworkCore.DbContextOptionsBuilder.LogTo%2A> --> <span data-ttu-id="ff27a-145">lors [de la configuration d’une instance DbContext](xref:core/dbcontext-configuration/index).</span><span class="sxs-lookup"><span data-stu-id="ff27a-145">when [configuring a DbContext instance](xref:core/dbcontext-configuration/index).</span></span> <span data-ttu-id="ff27a-146">Cette configuration s’effectue généralement dans une substitution de <xref:Microsoft.EntityFrameworkCore.DbContext.OnConfiguring%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="ff27a-146">This configuration is commonly done in an override of <xref:Microsoft.EntityFrameworkCore.DbContext.OnConfiguring%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="ff27a-147">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="ff27a-147">For example:</span></span>

<!--
    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
        => optionsBuilder.LogTo(Console.WriteLine);
-->
[!code-csharp[LogToConsole](../../../samples/core/Miscellaneous/Logging/SimpleLogging/Program.cs?name=LogToConsole)]

<span data-ttu-id="ff27a-148">Ce concept est semblable à <xref:System.Data.Entity.Database.Log?displayProperty=nameWithType> dans EF6.</span><span class="sxs-lookup"><span data-stu-id="ff27a-148">This concept is similar to <xref:System.Data.Entity.Database.Log?displayProperty=nameWithType> in EF6.</span></span>

<span data-ttu-id="ff27a-149">Pour plus d’informations, consultez [journalisation simple](xref:core/logging-events-diagnostics/simple-logging) .</span><span class="sxs-lookup"><span data-stu-id="ff27a-149">See [Simple Logging](xref:core/logging-events-diagnostics/simple-logging) for more information.</span></span>

## <a name="microsoftextensionslogging"></a><span data-ttu-id="ff27a-150">Microsoft.Extensions.Logging</span><span class="sxs-lookup"><span data-stu-id="ff27a-150">Microsoft.Extensions.Logging</span></span>

<span data-ttu-id="ff27a-151">[Microsoft. extensions. Logging](/dotnet/core/extensions/logging) est un mécanisme de journalisation extensible avec des fournisseurs de plug-ins pour de nombreux systèmes de journalisation courants.</span><span class="sxs-lookup"><span data-stu-id="ff27a-151">[Microsoft.Extensions.Logging](/dotnet/core/extensions/logging) is an extensible logging mechanism with plug-in providers for many common logging systems.</span></span> <span data-ttu-id="ff27a-152">EF Core s’intègre entièrement à `Microsoft.Extensions.Logging` et cette forme de journalisation est utilisée par défaut pour les applications ASP.net core.</span><span class="sxs-lookup"><span data-stu-id="ff27a-152">EF Core fully integrates with `Microsoft.Extensions.Logging` and this form of logging is used by default for ASP.NET Core applications.</span></span>

<span data-ttu-id="ff27a-153">Pour plus d’informations, consultez [utilisation de Microsoft. extensions. Logging dans EF Core](xref:core/logging-events-diagnostics/extensions-logging) .</span><span class="sxs-lookup"><span data-stu-id="ff27a-153">See [Using Microsoft.Extensions.Logging in EF Core](xref:core/logging-events-diagnostics/extensions-logging) for more information.</span></span>

## <a name="events"></a><span data-ttu-id="ff27a-154">Événements</span><span class="sxs-lookup"><span data-stu-id="ff27a-154">Events</span></span>

> [!NOTE]
> <span data-ttu-id="ff27a-155">Des événements supplémentaires ont été ajoutés dans EF Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="ff27a-155">Additional events were added in EF Core 5.0.</span></span>

<span data-ttu-id="ff27a-156">EF Core expose des [événements .net](/dotnet/standard/events/) pour agir en tant que rappels lorsque certains événements se produisent dans le code EF Core.</span><span class="sxs-lookup"><span data-stu-id="ff27a-156">EF Core exposes [.NET events](/dotnet/standard/events/) to act as callbacks when certain things happen in the EF Core code.</span></span> <span data-ttu-id="ff27a-157">Les événements sont plus simples que les intercepteurs et permettent une inscription plus flexible.</span><span class="sxs-lookup"><span data-stu-id="ff27a-157">Events are simpler than interceptors and allow more flexible registration.</span></span> <span data-ttu-id="ff27a-158">Toutefois, ils sont synchronisés uniquement et ne peuvent donc pas effectuer d’e/s Async non bloquantes.</span><span class="sxs-lookup"><span data-stu-id="ff27a-158">However, they are sync only and so cannot perform non-blocking async I/O.</span></span>

<span data-ttu-id="ff27a-159">Les événements sont inscrits par instance DbContext et cette inscription peut être effectuée à tout moment.</span><span class="sxs-lookup"><span data-stu-id="ff27a-159">Events are registered per DbContext instance and this registration can be done at any time.</span></span> <span data-ttu-id="ff27a-160">Utilisez un [écouteur de diagnostic](xref:core/logging-events-diagnostics/diagnostic-listeners) pour obtenir les mêmes informations, mais pour toutes les instances de DbContext dans le processus.</span><span class="sxs-lookup"><span data-stu-id="ff27a-160">Use a [diagnostic listener](xref:core/logging-events-diagnostics/diagnostic-listeners) to get the same information but for all DbContext instances in the process.</span></span>

<span data-ttu-id="ff27a-161">Pour plus d’informations, consultez [événements .net dans EF Core](xref:core/logging-events-diagnostics/events) .</span><span class="sxs-lookup"><span data-stu-id="ff27a-161">See [.NET Events in EF Core](xref:core/logging-events-diagnostics/events) for more information.</span></span>

## <a name="interception"></a><span data-ttu-id="ff27a-162">Interception</span><span class="sxs-lookup"><span data-stu-id="ff27a-162">Interception</span></span>

> [!NOTE]
> <span data-ttu-id="ff27a-163">Cette fonctionnalité a été ajoutée dans EF Core 3,0.</span><span class="sxs-lookup"><span data-stu-id="ff27a-163">This feature was added in EF Core 3.0.</span></span> <span data-ttu-id="ff27a-164">Des intercepteurs supplémentaires ont été ajoutés dans EF Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="ff27a-164">Additional interceptors were added in EF Core 5.0.</span></span>

<span data-ttu-id="ff27a-165">Les intercepteurs de EF Core permettent l’interception, la modification et/ou la suppression d’opérations de EF Core.</span><span class="sxs-lookup"><span data-stu-id="ff27a-165">EF Core interceptors enable interception, modification, and/or suppression of EF Core operations.</span></span> <span data-ttu-id="ff27a-166">Cela comprend les opérations de base de données de bas niveau telles que l’exécution d’une commande, ainsi que les opérations de niveau supérieur, telles que les appels à SaveChanges.</span><span class="sxs-lookup"><span data-stu-id="ff27a-166">This includes low-level database operations such as executing a command, as well as higher-level operations, such as calls to SaveChanges.</span></span>

<span data-ttu-id="ff27a-167">Les intercepteurs diffèrent de la journalisation et des diagnostics en ce qu’ils autorisent la modification ou la suppression de l’opération qui est interceptée.</span><span class="sxs-lookup"><span data-stu-id="ff27a-167">Interceptors are different from logging and diagnostics in that they allow modification or suppression of the operation being intercepted.</span></span> <span data-ttu-id="ff27a-168">La journalisation [simple](xref:core/logging-events-diagnostics/simple-logging) ou [Microsoft. extensions. Logging](xref:core/logging-events-diagnostics/extensions-logging) sont de meilleures options pour la journalisation.</span><span class="sxs-lookup"><span data-stu-id="ff27a-168">[Simple logging](xref:core/logging-events-diagnostics/simple-logging) or [Microsoft.Extensions.Logging](xref:core/logging-events-diagnostics/extensions-logging) are better choices for logging.</span></span>

<span data-ttu-id="ff27a-169">Les intercepteurs sont inscrits par instance DbContext lorsque le contexte est configuré.</span><span class="sxs-lookup"><span data-stu-id="ff27a-169">Interceptors are registered per DbContext instance when the context is configured.</span></span> <span data-ttu-id="ff27a-170">Utilisez un [écouteur de diagnostic](xref:core/logging-events-diagnostics/diagnostic-listeners) pour obtenir les mêmes informations, mais pour toutes les instances de DbContext dans le processus.</span><span class="sxs-lookup"><span data-stu-id="ff27a-170">Use a [diagnostic listener](xref:core/logging-events-diagnostics/diagnostic-listeners) to get the same information but for all DbContext instances in the process.</span></span>

<span data-ttu-id="ff27a-171">Pour plus d’informations, consultez [interception](xref:core/logging-events-diagnostics/interceptors) .</span><span class="sxs-lookup"><span data-stu-id="ff27a-171">See [Interception](xref:core/logging-events-diagnostics/interceptors) for more information.</span></span>

## <a name="diagnostic-listeners"></a><span data-ttu-id="ff27a-172">Écouteurs de diagnostic</span><span class="sxs-lookup"><span data-stu-id="ff27a-172">Diagnostic listeners</span></span>

<span data-ttu-id="ff27a-173">Les écouteurs de diagnostic permettent d’écouter les EF Core événement qui se produit dans le processus .NET actuel.</span><span class="sxs-lookup"><span data-stu-id="ff27a-173">Diagnostic listeners allow listening for any EF Core event that occurs in the current .NET process.</span></span>

<span data-ttu-id="ff27a-174">Les écouteurs de diagnostic ne sont pas adaptés à l’obtention d’événements à partir d’une seule instance DbContext.</span><span class="sxs-lookup"><span data-stu-id="ff27a-174">Diagnostic listeners are not suitable for getting events from a single DbContext instance.</span></span> <span data-ttu-id="ff27a-175">Les intercepteurs EF Core donnent accès aux mêmes événements avec l’inscription par contexte.</span><span class="sxs-lookup"><span data-stu-id="ff27a-175">EF Core interceptors provide access to the same events with per-context registration.</span></span>

<span data-ttu-id="ff27a-176">Les écouteurs de diagnostic ne sont pas conçus pour la journalisation.</span><span class="sxs-lookup"><span data-stu-id="ff27a-176">Diagnostic listeners are not designed for logging.</span></span> <span data-ttu-id="ff27a-177">La journalisation [simple](xref:core/logging-events-diagnostics/simple-logging) ou [Microsoft. extensions. Logging](xref:core/logging-events-diagnostics/extensions-logging) sont de meilleures options pour la journalisation.</span><span class="sxs-lookup"><span data-stu-id="ff27a-177">[Simple logging](xref:core/logging-events-diagnostics/simple-logging) or [Microsoft.Extensions.Logging](xref:core/logging-events-diagnostics/extensions-logging) are better choices for logging.</span></span>

<span data-ttu-id="ff27a-178">Pour plus d’informations, consultez [utilisation des écouteurs de diagnostics dans EF Core](xref:core/logging-events-diagnostics/diagnostic-listeners) .</span><span class="sxs-lookup"><span data-stu-id="ff27a-178">See [Using diagnostic listeners in EF Core](xref:core/logging-events-diagnostics/diagnostic-listeners) for more information.</span></span>
