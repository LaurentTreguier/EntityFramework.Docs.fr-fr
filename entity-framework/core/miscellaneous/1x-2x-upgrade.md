---
title: Mise à niveau des versions précédentes vers EF Core 2-EF Core
author: divega
ms.date: 08/13/2017
ms.assetid: 8BD43C8C-63D9-4F3A-B954-7BC518A1B7DB
uid: core/miscellaneous/1x-2x-upgrade
ms.openlocfilehash: b27c09fdb6210dd7c6aa0c8bc912a8bd183c16b9
ms.sourcegitcommit: cc0ff36e46e9ed3527638f7208000e8521faef2e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78416755"
---
# <a name="upgrading-applications-from-previous-versions-to-ef-core-20"></a><span data-ttu-id="f9dac-102">Mise à niveau des applications des versions précédentes vers EF Core 2,0</span><span class="sxs-lookup"><span data-stu-id="f9dac-102">Upgrading applications from previous versions to EF Core 2.0</span></span>

<span data-ttu-id="f9dac-103">Nous avons pris la possibilité d’affiner de manière significative nos API et comportements existants dans 2,0.</span><span class="sxs-lookup"><span data-stu-id="f9dac-103">We have taken the opportunity to significantly refine our existing APIs and behaviors in 2.0.</span></span> <span data-ttu-id="f9dac-104">Il existe quelques améliorations qui peuvent nécessiter la modification du code d’application existant, même si nous pensons que pour la majorité des applications, l’impact sera faible, dans la plupart des cas nécessitant juste une recompilation et des modifications guidées minimes pour remplacer les API obsolètes.</span><span class="sxs-lookup"><span data-stu-id="f9dac-104">There are a few improvements that can require modifying existing application code, although we believe that for the majority of applications the impact will be low, in most cases requiring just recompilation and minimal guided changes to replace obsolete APIs.</span></span>

<span data-ttu-id="f9dac-105">La mise à jour d’une application existante vers EF Core 2,0 peut nécessiter les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="f9dac-105">Updating an existing application to EF Core 2.0 may require:</span></span>

1. <span data-ttu-id="f9dac-106">Mise à niveau de l’implémentation .NET cible de l’application vers une implémentation qui prend en charge .NET Standard 2,0.</span><span class="sxs-lookup"><span data-stu-id="f9dac-106">Upgrading the target .NET implementation of the application to one that supports .NET Standard 2.0.</span></span> <span data-ttu-id="f9dac-107">Pour plus d’informations, consultez [implémentations .net prises en charge](xref:core/platforms/index) .</span><span class="sxs-lookup"><span data-stu-id="f9dac-107">See [Supported .NET Implementations](xref:core/platforms/index) for more details.</span></span>

2. <span data-ttu-id="f9dac-108">Identifiez un fournisseur pour la base de données cible qui est compatible avec EF Core 2,0.</span><span class="sxs-lookup"><span data-stu-id="f9dac-108">Identify a provider for the target database which is compatible with EF Core 2.0.</span></span> <span data-ttu-id="f9dac-109">Consultez [EF Core 2,0 requiert un fournisseur de base de données 2,0](#ef-core-20-requires-a-20-database-provider) ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="f9dac-109">See [EF Core 2.0 requires a 2.0 database provider](#ef-core-20-requires-a-20-database-provider) below.</span></span>

3. <span data-ttu-id="f9dac-110">Mise à niveau de tous les packages de EF Core (Runtime et outils) vers 2,0.</span><span class="sxs-lookup"><span data-stu-id="f9dac-110">Upgrading all the EF Core packages (runtime and tooling) to 2.0.</span></span> <span data-ttu-id="f9dac-111">Pour plus d’informations, consultez [installation de EF Core](xref:core/get-started/install/index) .</span><span class="sxs-lookup"><span data-stu-id="f9dac-111">Refer to [Installing EF Core](xref:core/get-started/install/index) for more details.</span></span>

4. <span data-ttu-id="f9dac-112">Apportez les modifications nécessaires au code pour compenser les modifications avec rupture décrites dans le reste de ce document.</span><span class="sxs-lookup"><span data-stu-id="f9dac-112">Make any necessary code changes to compensate for the breaking changes described in the rest of this document.</span></span>

## <a name="aspnet-core-now-includes-ef-core"></a><span data-ttu-id="f9dac-113">ASP.NET Core comprend maintenant EF Core</span><span class="sxs-lookup"><span data-stu-id="f9dac-113">ASP.NET Core now includes EF Core</span></span>

<span data-ttu-id="f9dac-114">Les applications ciblant ASP.NET Core 2.0 peuvent utiliser EF Core 2.0 sans dépendances supplémentaires en plus des fournisseurs de base de données tiers.</span><span class="sxs-lookup"><span data-stu-id="f9dac-114">Applications targeting ASP.NET Core 2.0 can use EF Core 2.0 without additional dependencies besides third party database providers.</span></span> <span data-ttu-id="f9dac-115">Toutefois, les applications ciblant des versions antérieures de ASP.NET Core doivent effectuer une mise à niveau vers ASP.NET Core 2,0 afin d’utiliser EF Core 2,0.</span><span class="sxs-lookup"><span data-stu-id="f9dac-115">However, applications targeting previous versions of ASP.NET Core need to upgrade to ASP.NET Core 2.0 in order to use EF Core 2.0.</span></span> <span data-ttu-id="f9dac-116">Pour plus d’informations sur la mise à niveau des applications ASP.NET Core vers 2,0, consultez [la documentation ASP.net Core sur le sujet](/aspnet/core/migration/1x-to-2x/).</span><span class="sxs-lookup"><span data-stu-id="f9dac-116">For more details on upgrading ASP.NET Core applications to 2.0 see [the ASP.NET Core documentation on the subject](/aspnet/core/migration/1x-to-2x/).</span></span>

## <a name="new-way-of-getting-application-services-in-aspnet-core"></a><span data-ttu-id="f9dac-117">Nouvelle méthode d’obtention des services d’application dans ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="f9dac-117">New way of getting application services in ASP.NET Core</span></span>

<span data-ttu-id="f9dac-118">Le modèle recommandé pour les applications Web ASP.NET Core a été mis à jour pour 2,0 d’une manière qui a enfreint la logique au moment de la conception EF Core utilisée dans 1. x.</span><span class="sxs-lookup"><span data-stu-id="f9dac-118">The recommended pattern for ASP.NET Core web applications has been updated for 2.0 in a way that broke the design-time logic EF Core used in 1.x.</span></span> <span data-ttu-id="f9dac-119">Auparavant, lors de la conception, EF Core essaiera d’appeler `Startup.ConfigureServices` directement afin d’accéder au fournisseur de services de l’application.</span><span class="sxs-lookup"><span data-stu-id="f9dac-119">Previously at design-time, EF Core would try to invoke `Startup.ConfigureServices` directly in order to access the application's service provider.</span></span> <span data-ttu-id="f9dac-120">Dans ASP.NET Core 2,0, la configuration est initialisée en dehors de la classe `Startup`.</span><span class="sxs-lookup"><span data-stu-id="f9dac-120">In ASP.NET Core 2.0, Configuration is initialized outside of the `Startup` class.</span></span> <span data-ttu-id="f9dac-121">Les applications qui utilisent EF Core généralement accéder à leur chaîne de connexion à partir de la configuration, de sorte que `Startup` n’est plus suffisant.</span><span class="sxs-lookup"><span data-stu-id="f9dac-121">Applications using EF Core typically access their connection string from Configuration, so `Startup` by itself is no longer sufficient.</span></span> <span data-ttu-id="f9dac-122">Si vous mettez à niveau une application ASP.NET Core 1. x, vous risquez de recevoir l’erreur suivante lors de l’utilisation des outils de EF Core.</span><span class="sxs-lookup"><span data-stu-id="f9dac-122">If you upgrade an ASP.NET Core 1.x application, you may receive the following error when using the EF Core tools.</span></span>

> <span data-ttu-id="f9dac-123">Aucun constructeur sans paramètre n’a été trouvé sur’ApplicationContext'.</span><span class="sxs-lookup"><span data-stu-id="f9dac-123">No parameterless constructor was found on 'ApplicationContext'.</span></span> <span data-ttu-id="f9dac-124">Ajoutez un constructeur sans paramètre à’ApplicationContext’ou ajoutez une implémentation de’IDesignTimeDbContextFactory&lt;ApplicationContext&gt;'dans le même assembly que’ApplicationContext'</span><span class="sxs-lookup"><span data-stu-id="f9dac-124">Either add a parameterless constructor to 'ApplicationContext' or add an implementation of 'IDesignTimeDbContextFactory&lt;ApplicationContext&gt;' in the same assembly as 'ApplicationContext'</span></span>

<span data-ttu-id="f9dac-125">Un nouveau Hook au moment du design a été ajouté au modèle par défaut de ASP.NET Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="f9dac-125">A new design-time hook has been added in ASP.NET Core 2.0's default template.</span></span> <span data-ttu-id="f9dac-126">La méthode `Program.BuildWebHost` statique permet à EF Core d’accéder au fournisseur de services de l’application au moment de la conception.</span><span class="sxs-lookup"><span data-stu-id="f9dac-126">The static `Program.BuildWebHost` method enables EF Core to access the application's service provider at design time.</span></span> <span data-ttu-id="f9dac-127">Si vous mettez à niveau une application ASP.NET Core 1. x, vous devrez mettre à jour la classe `Program` pour qu’elle ressemble à ce qui suit.</span><span class="sxs-lookup"><span data-stu-id="f9dac-127">If you are upgrading an ASP.NET Core 1.x application, you will need to update the `Program` class to resemble the following.</span></span>

``` csharp
using Microsoft.AspNetCore;
using Microsoft.AspNetCore.Hosting;

namespace AspNetCoreDotNetCore2._0App
{
    public class Program
    {
        public static void Main(string[] args)
        {
            BuildWebHost(args).Run();
        }

        public static IWebHost BuildWebHost(string[] args) =>
            WebHost.CreateDefaultBuilder(args)
                .UseStartup<Startup>()
                .Build();
    }
}
```

<span data-ttu-id="f9dac-128">L’adoption de ce nouveau modèle lors de la mise à jour des applications vers 2,0 est vivement recommandée et est nécessaire pour que des fonctionnalités de produit telles que Entity Framework Core migrations fonctionnent.</span><span class="sxs-lookup"><span data-stu-id="f9dac-128">The adoption of this new pattern when updating applications to 2.0 is highly recommended and is required in order for product features like Entity Framework Core Migrations to work.</span></span> <span data-ttu-id="f9dac-129">L’autre alternative courante consiste à [implémenter *IDesignTimeDbContextFactory\<TContext >* ](xref:core/miscellaneous/cli/dbcontext-creation#from-a-design-time-factory).</span><span class="sxs-lookup"><span data-stu-id="f9dac-129">The other common alternative is to [implement *IDesignTimeDbContextFactory\<TContext>*](xref:core/miscellaneous/cli/dbcontext-creation#from-a-design-time-factory).</span></span>

## <a name="idbcontextfactory-renamed"></a><span data-ttu-id="f9dac-130">IDbContextFactory renommée</span><span class="sxs-lookup"><span data-stu-id="f9dac-130">IDbContextFactory renamed</span></span>

<span data-ttu-id="f9dac-131">Afin de prendre en charge divers modèles d’application et de permettre aux utilisateurs de mieux contrôler la façon dont leurs `DbContext` sont utilisés au moment de la conception, nous avons, par le passé, fourni l’interface `IDbContextFactory<TContext>`.</span><span class="sxs-lookup"><span data-stu-id="f9dac-131">In order to support diverse application patterns and give users more control over how their `DbContext` is used at design time, we have, in the past, provided the `IDbContextFactory<TContext>` interface.</span></span> <span data-ttu-id="f9dac-132">Au moment du design, les outils de EF Core découvrent les implémentations de cette interface dans votre projet et l’utilisent pour créer des objets `DbContext`.</span><span class="sxs-lookup"><span data-stu-id="f9dac-132">At design-time, the EF Core tools will discover implementations of this interface in your project and use it to create `DbContext` objects.</span></span>

<span data-ttu-id="f9dac-133">Cette interface a un nom très général qui induire certains utilisateurs à essayer de les réutiliser pour d’autres scénarios de création de `DbContext`.</span><span class="sxs-lookup"><span data-stu-id="f9dac-133">This interface had a very general name which mislead some users to try re-using it for other `DbContext`-creating scenarios.</span></span> <span data-ttu-id="f9dac-134">Ils ont été interceptés contre la protection lorsque les outils EF ont ensuite essayé d’utiliser leur implémentation au moment de la conception et ont provoqué l’échec des commandes comme `Update-Database` ou `dotnet ef database update`.</span><span class="sxs-lookup"><span data-stu-id="f9dac-134">They were caught off guard when the EF Tools then tried to use their implementation at design-time and caused commands like `Update-Database` or `dotnet ef database update` to fail.</span></span>

<span data-ttu-id="f9dac-135">Pour pouvoir communiquer la sémantique forte au moment de la conception de cette interface, nous l’avons renommée en `IDesignTimeDbContextFactory<TContext>`.</span><span class="sxs-lookup"><span data-stu-id="f9dac-135">In order to communicate the strong design-time semantics of this interface, we have renamed it to `IDesignTimeDbContextFactory<TContext>`.</span></span>

<span data-ttu-id="f9dac-136">Pour la version 2,0, le `IDbContextFactory<TContext>` existe toujours, mais est marqué comme obsolète.</span><span class="sxs-lookup"><span data-stu-id="f9dac-136">For the 2.0 release the `IDbContextFactory<TContext>` still exists but is marked as obsolete.</span></span>

## <a name="dbcontextfactoryoptions-removed"></a><span data-ttu-id="f9dac-137">DbContextFactoryOptions supprimé</span><span class="sxs-lookup"><span data-stu-id="f9dac-137">DbContextFactoryOptions removed</span></span>

<span data-ttu-id="f9dac-138">En raison des modifications apportées à l’ASP.NET Core 2,0 décrites ci-dessus, nous avons découvert que `DbContextFactoryOptions` n’était plus nécessaire sur la nouvelle interface `IDesignTimeDbContextFactory<TContext>`.</span><span class="sxs-lookup"><span data-stu-id="f9dac-138">Because of the ASP.NET Core 2.0 changes described above, we found that `DbContextFactoryOptions` was no longer needed on the new `IDesignTimeDbContextFactory<TContext>` interface.</span></span> <span data-ttu-id="f9dac-139">Voici les alternatives que vous devez utiliser à la place.</span><span class="sxs-lookup"><span data-stu-id="f9dac-139">Here are the alternatives you should be using instead.</span></span>

| <span data-ttu-id="f9dac-140">DbContextFactoryOptions</span><span class="sxs-lookup"><span data-stu-id="f9dac-140">DbContextFactoryOptions</span></span> | <span data-ttu-id="f9dac-141">Alternative</span><span class="sxs-lookup"><span data-stu-id="f9dac-141">Alternative</span></span>                                                  |
|:------------------------|:-------------------------------------------------------------|
| <span data-ttu-id="f9dac-142">ApplicationBasePath</span><span class="sxs-lookup"><span data-stu-id="f9dac-142">ApplicationBasePath</span></span>     | <span data-ttu-id="f9dac-143">AppContext.BaseDirectory</span><span class="sxs-lookup"><span data-stu-id="f9dac-143">AppContext.BaseDirectory</span></span>                                     |
| <span data-ttu-id="f9dac-144">ContentRootPath</span><span class="sxs-lookup"><span data-stu-id="f9dac-144">ContentRootPath</span></span>         | <span data-ttu-id="f9dac-145">Directory.GetCurrentDirectory()</span><span class="sxs-lookup"><span data-stu-id="f9dac-145">Directory.GetCurrentDirectory()</span></span>                              |
| <span data-ttu-id="f9dac-146">EnvironmentName</span><span class="sxs-lookup"><span data-stu-id="f9dac-146">EnvironmentName</span></span>         | <span data-ttu-id="f9dac-147">Environment. GetEnvironmentVariable ("ASPNETCORE_ENVIRONMENT")</span><span class="sxs-lookup"><span data-stu-id="f9dac-147">Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT")</span></span> |

## <a name="design-time-working-directory-changed"></a><span data-ttu-id="f9dac-148">Modification du répertoire de travail au moment du design</span><span class="sxs-lookup"><span data-stu-id="f9dac-148">Design-time working directory changed</span></span>

<span data-ttu-id="f9dac-149">Les modifications apportées au ASP.NET Core 2,0 ont également nécessité le répertoire de travail utilisé par `dotnet ef` pour s’aligner avec le répertoire de travail utilisé par Visual Studio lors de l’exécution de votre application.</span><span class="sxs-lookup"><span data-stu-id="f9dac-149">The ASP.NET Core 2.0 changes also required the working directory used by `dotnet ef` to align with the working directory used by Visual Studio when running your application.</span></span> <span data-ttu-id="f9dac-150">L’un des effets secondaires observables est que les noms de fichiers SQLite sont désormais relatifs au répertoire du projet, et non au répertoire de sortie comme s’ils étaient utilisés.</span><span class="sxs-lookup"><span data-stu-id="f9dac-150">One observable side effect of this is that SQLite filenames are now relative to the project directory and not the output directory like they used to be.</span></span>

## <a name="ef-core-20-requires-a-20-database-provider"></a><span data-ttu-id="f9dac-151">EF Core 2,0 requiert un fournisseur de base de données 2,0</span><span class="sxs-lookup"><span data-stu-id="f9dac-151">EF Core 2.0 requires a 2.0 database provider</span></span>

<span data-ttu-id="f9dac-152">Pour EF Core 2,0, nous avons apporté de nombreuses simplifications et améliorations au fonctionnement des fournisseurs de bases de données.</span><span class="sxs-lookup"><span data-stu-id="f9dac-152">For EF Core 2.0 we have made many simplifications and improvements in the way database providers work.</span></span> <span data-ttu-id="f9dac-153">Cela signifie que les fournisseurs 1.0. x et 1.1. x ne fonctionneront pas avec EF Core 2,0.</span><span class="sxs-lookup"><span data-stu-id="f9dac-153">This means that 1.0.x and 1.1.x providers will not work with EF Core 2.0.</span></span>

<span data-ttu-id="f9dac-154">Les fournisseurs SQL Server et SQLite sont fournis par l’équipe EF et les versions 2,0 seront disponibles dans le cadre de la version 2,0.</span><span class="sxs-lookup"><span data-stu-id="f9dac-154">The SQL Server and SQLite providers are shipped by the EF team and 2.0 versions will be available as part of the 2.0 release.</span></span> <span data-ttu-id="f9dac-155">Les fournisseurs tiers Open source pour [SQL Compact](https://github.com/ErikEJ/EntityFramework.SqlServerCompact), [PostgreSQL](https://github.com/npgsql/Npgsql.EntityFrameworkCore.PostgreSQL)et [MySQL](https://github.com/PomeloFoundation/Pomelo.EntityFrameworkCore.MySql) sont mis à jour pour 2,0.</span><span class="sxs-lookup"><span data-stu-id="f9dac-155">The open-source third party providers for [SQL Compact](https://github.com/ErikEJ/EntityFramework.SqlServerCompact), [PostgreSQL](https://github.com/npgsql/Npgsql.EntityFrameworkCore.PostgreSQL), and [MySQL](https://github.com/PomeloFoundation/Pomelo.EntityFrameworkCore.MySql) are being updated for 2.0.</span></span> <span data-ttu-id="f9dac-156">Pour tous les autres fournisseurs, contactez le rédacteur du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="f9dac-156">For all other providers, please contact the provider writer.</span></span>

## <a name="logging-and-diagnostics-events-have-changed"></a><span data-ttu-id="f9dac-157">Les événements de journalisation et de diagnostic ont changé</span><span class="sxs-lookup"><span data-stu-id="f9dac-157">Logging and Diagnostics events have changed</span></span>

<span data-ttu-id="f9dac-158">Remarque : ces modifications ne doivent pas avoir d’impact sur la plupart du code d’application.</span><span class="sxs-lookup"><span data-stu-id="f9dac-158">Note: these changes should not impact most application code.</span></span>

<span data-ttu-id="f9dac-159">Les ID d’événement pour les messages envoyés à un [ILogger](/dotnet/api/microsoft.extensions.logging.ilogger) ont été modifiés dans 2,0.</span><span class="sxs-lookup"><span data-stu-id="f9dac-159">The event IDs for messages sent to an [ILogger](/dotnet/api/microsoft.extensions.logging.ilogger) have changed in 2.0.</span></span> <span data-ttu-id="f9dac-160">Les ID d’événement sont maintenant uniques dans le code EF Core.</span><span class="sxs-lookup"><span data-stu-id="f9dac-160">The event IDs are now unique across EF Core code.</span></span> <span data-ttu-id="f9dac-161">En outre, ces messages suivent désormais le modèle standard de la journalisation structurée utilisé, par exemple, par le modèle MVC.</span><span class="sxs-lookup"><span data-stu-id="f9dac-161">These messages now also follow the standard pattern for structured logging used by, for example, MVC.</span></span>

<span data-ttu-id="f9dac-162">Les catégories d’enregistreurs d’événements ont également changé.</span><span class="sxs-lookup"><span data-stu-id="f9dac-162">Logger categories have also changed.</span></span> <span data-ttu-id="f9dac-163">Il existe désormais un jeu connu de catégories accessibles par le biais de [DbLoggerCategory](https://github.com/aspnet/EntityFrameworkCore/blob/rel/2.0.0/src/EFCore/DbLoggerCategory.cs).</span><span class="sxs-lookup"><span data-stu-id="f9dac-163">There is now a well-known set of categories accessed through [DbLoggerCategory](https://github.com/aspnet/EntityFrameworkCore/blob/rel/2.0.0/src/EFCore/DbLoggerCategory.cs).</span></span>

<span data-ttu-id="f9dac-164">Les événements [DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md) utilisent désormais les mêmes noms d’ID d’événements que les messages `ILogger` correspondants.</span><span class="sxs-lookup"><span data-stu-id="f9dac-164">[DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md) events now use the same event ID names as the corresponding `ILogger` messages.</span></span> <span data-ttu-id="f9dac-165">Les charges utiles d’événement sont tous des types nominaux dérivés de [EventData](/dotnet/api/microsoft.entityframeworkcore.diagnostics.eventdata).</span><span class="sxs-lookup"><span data-stu-id="f9dac-165">The event payloads are all nominal types derived from [EventData](/dotnet/api/microsoft.entityframeworkcore.diagnostics.eventdata).</span></span>

<span data-ttu-id="f9dac-166">Les ID d’événement, les types de charge utile et les catégories sont documentés dans les classes [CoreEventId](/dotnet/api/microsoft.entityframeworkcore.diagnostics.coreeventid) et [RelationalEventId](/dotnet/api/microsoft.entityframeworkcore.diagnostics.relationaleventid) .</span><span class="sxs-lookup"><span data-stu-id="f9dac-166">Event IDs, payload types, and categories are documented in the [CoreEventId](/dotnet/api/microsoft.entityframeworkcore.diagnostics.coreeventid) and the [RelationalEventId](/dotnet/api/microsoft.entityframeworkcore.diagnostics.relationaleventid) classes.</span></span>

<span data-ttu-id="f9dac-167">Les ID ont également été déplacés de Microsoft. EntityFrameworkCore. infrastructure vers le nouvel espace de noms Microsoft. EntityFrameworkCore. Diagnostics.</span><span class="sxs-lookup"><span data-stu-id="f9dac-167">IDs have also moved from Microsoft.EntityFrameworkCore.Infrastructure to the new Microsoft.EntityFrameworkCore.Diagnostics namespace.</span></span>

## <a name="ef-core-relational-metadata-api-changes"></a><span data-ttu-id="f9dac-168">EF Core les modifications de l’API de métadonnées relationnelles</span><span class="sxs-lookup"><span data-stu-id="f9dac-168">EF Core relational metadata API changes</span></span>

<span data-ttu-id="f9dac-169">EF Core 2.0 génère désormais un [IModel](/dotnet/api/microsoft.entityframeworkcore.metadata.imodel) différent par fournisseur utilisé.</span><span class="sxs-lookup"><span data-stu-id="f9dac-169">EF Core 2.0 will now build a different [IModel](/dotnet/api/microsoft.entityframeworkcore.metadata.imodel) for each different provider being used.</span></span> <span data-ttu-id="f9dac-170">Cela est généralement transparent pour l’application.</span><span class="sxs-lookup"><span data-stu-id="f9dac-170">This is usually transparent to the application.</span></span> <span data-ttu-id="f9dac-171">Cela a facilité la simplification des API de métadonnées de niveau inférieur, de telle sorte que tout accès à des _concepts de métadonnées relationnelles communs_ soit toujours effectué via un appel à `.Relational` au lieu de `.SqlServer`, `.Sqlite`, etc. Par exemple, le code 1.1. x ressemble à ceci :</span><span class="sxs-lookup"><span data-stu-id="f9dac-171">This has facilitated a simplification of lower-level metadata APIs such that any access to _common relational metadata concepts_ is always made through a call to `.Relational` instead of `.SqlServer`, `.Sqlite`, etc. For example, 1.1.x code like this:</span></span>

``` csharp
var tableName = context.Model.FindEntityType(typeof(User)).SqlServer().TableName;
```

<span data-ttu-id="f9dac-172">Doit maintenant être écrit comme suit :</span><span class="sxs-lookup"><span data-stu-id="f9dac-172">Should now be written like this:</span></span>

``` csharp
var tableName = context.Model.FindEntityType(typeof(User)).Relational().TableName;
```

<span data-ttu-id="f9dac-173">Au lieu d’utiliser des méthodes comme `ForSqlServerToTable`, les méthodes d’extension sont désormais disponibles pour écrire du code conditionnel en fonction du fournisseur actuel en cours d’utilisation.</span><span class="sxs-lookup"><span data-stu-id="f9dac-173">Instead of using methods like `ForSqlServerToTable`, extension methods are now available to write conditional code based on the current provider in use.</span></span> <span data-ttu-id="f9dac-174">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="f9dac-174">For example:</span></span>

```csharp
modelBuilder.Entity<User>().ToTable(
    Database.IsSqlServer() ? "SqlServerName" : "OtherName");
```

<span data-ttu-id="f9dac-175">Notez que cette modification s’applique uniquement aux API/métadonnées définies pour _tous les_ fournisseurs relationnels.</span><span class="sxs-lookup"><span data-stu-id="f9dac-175">Note that this change only applies to APIs/metadata that is defined for _all_ relational providers.</span></span> <span data-ttu-id="f9dac-176">L’API et les métadonnées restent les mêmes lorsqu’elles sont spécifiques à un seul fournisseur.</span><span class="sxs-lookup"><span data-stu-id="f9dac-176">The API and metadata remains the same when it is specific to only a single provider.</span></span> <span data-ttu-id="f9dac-177">Par exemple, les index cluster sont spécifiques à SQL Server, de sorte que `ForSqlServerIsClustered` et `.SqlServer().IsClustered()` doivent toujours être utilisés.</span><span class="sxs-lookup"><span data-stu-id="f9dac-177">For example, clustered indexes are specific to SQL Sever, so `ForSqlServerIsClustered` and  `.SqlServer().IsClustered()` must still be used.</span></span>

## <a name="dont-take-control-of-the-ef-service-provider"></a><span data-ttu-id="f9dac-178">Ne prenez pas le contrôle du fournisseur de services EF</span><span class="sxs-lookup"><span data-stu-id="f9dac-178">Don’t take control of the EF service provider</span></span>

<span data-ttu-id="f9dac-179">EF Core utilise un `IServiceProvider` interne (un conteneur d’injection de dépendances) pour son implémentation interne.</span><span class="sxs-lookup"><span data-stu-id="f9dac-179">EF Core uses an internal `IServiceProvider` (a dependency injection container) for its internal implementation.</span></span> <span data-ttu-id="f9dac-180">Les applications doivent autoriser EF Core à créer et à gérer ce fournisseur, sauf dans des cas spéciaux.</span><span class="sxs-lookup"><span data-stu-id="f9dac-180">Applications should allow EF Core to create and manage this provider except in special cases.</span></span> <span data-ttu-id="f9dac-181">Envisagez fortement de supprimer les appels à `UseInternalServiceProvider`.</span><span class="sxs-lookup"><span data-stu-id="f9dac-181">Strongly consider removing any calls to `UseInternalServiceProvider`.</span></span> <span data-ttu-id="f9dac-182">Si une application n’a pas besoin d’appeler `UseInternalServiceProvider`, envisagez de [soumettre un problème](https://github.com/aspnet/EntityFramework/Issues) afin que nous puissions étudier d’autres façons de gérer votre scénario.</span><span class="sxs-lookup"><span data-stu-id="f9dac-182">If an application does need to call `UseInternalServiceProvider`, then please consider [filing an issue](https://github.com/aspnet/EntityFramework/Issues) so we can investigate other ways to handle your scenario.</span></span>

<span data-ttu-id="f9dac-183">L’appel de `AddEntityFramework`, `AddEntityFrameworkSqlServer`, etc. n’est pas requis par le code d’application, sauf si `UseInternalServiceProvider` est également appelé.</span><span class="sxs-lookup"><span data-stu-id="f9dac-183">Calling `AddEntityFramework`, `AddEntityFrameworkSqlServer`, etc. is not required by application code unless `UseInternalServiceProvider` is also called.</span></span> <span data-ttu-id="f9dac-184">Supprimez tous les appels existants à `AddEntityFramework` ou `AddEntityFrameworkSqlServer`, etc. `AddDbContext` doit toujours être utilisé de la même façon qu’auparavant.</span><span class="sxs-lookup"><span data-stu-id="f9dac-184">Remove any existing calls to `AddEntityFramework` or `AddEntityFrameworkSqlServer`, etc. `AddDbContext` should still be used in the same way as before.</span></span>

## <a name="in-memory-databases-must-be-named"></a><span data-ttu-id="f9dac-185">Les bases de données en mémoire doivent être nommées</span><span class="sxs-lookup"><span data-stu-id="f9dac-185">In-memory databases must be named</span></span>

<span data-ttu-id="f9dac-186">La base de données en mémoire sans nom globale a été supprimée, mais toutes les bases de données en mémoire doivent être nommées.</span><span class="sxs-lookup"><span data-stu-id="f9dac-186">The global unnamed in-memory database has been removed and instead all in-memory databases must be named.</span></span> <span data-ttu-id="f9dac-187">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="f9dac-187">For example:</span></span>

``` csharp
optionsBuilder.UseInMemoryDatabase("MyDatabase");
```

<span data-ttu-id="f9dac-188">Crée/utilise une base de données nommée « MyDatabase ».</span><span class="sxs-lookup"><span data-stu-id="f9dac-188">This creates/uses a database with the name “MyDatabase”.</span></span> <span data-ttu-id="f9dac-189">Si `UseInMemoryDatabase` est à nouveau appelée avec le même nom, la même base de données en mémoire est utilisée, ce qui lui permet d’être partagé par plusieurs instances de contexte.</span><span class="sxs-lookup"><span data-stu-id="f9dac-189">If `UseInMemoryDatabase` is called again with the same name, then the same in-memory database will be used, allowing it to be shared by multiple context instances.</span></span>

## <a name="read-only-api-changes"></a><span data-ttu-id="f9dac-190">Modifications de l’API en lecture seule</span><span class="sxs-lookup"><span data-stu-id="f9dac-190">Read-only API changes</span></span>

<span data-ttu-id="f9dac-191">`IsReadOnlyBeforeSave`, `IsReadOnlyAfterSave`et `IsStoreGeneratedAlways` ont été obsolètes et remplacés par [BeforeSaveBehavior](/dotnet/api/microsoft.entityframeworkcore.metadata.iproperty.beforesavebehavior) et [AfterSaveBehavior](/dotnet/api/microsoft.entityframeworkcore.metadata.iproperty.aftersavebehavior).</span><span class="sxs-lookup"><span data-stu-id="f9dac-191">`IsReadOnlyBeforeSave`, `IsReadOnlyAfterSave`, and `IsStoreGeneratedAlways` have been obsoleted and replaced with [BeforeSaveBehavior](/dotnet/api/microsoft.entityframeworkcore.metadata.iproperty.beforesavebehavior) and [AfterSaveBehavior](/dotnet/api/microsoft.entityframeworkcore.metadata.iproperty.aftersavebehavior).</span></span> <span data-ttu-id="f9dac-192">Ces comportements s’appliquent à n’importe quelle propriété (non seulement les propriétés générées par le magasin) et déterminent la façon dont la valeur de la propriété doit être utilisée lors de l’insertion dans une ligne de base de données (`BeforeSaveBehavior`) ou lors de la mise à jour d’une ligne de base de données existante (`AfterSaveBehavior`).</span><span class="sxs-lookup"><span data-stu-id="f9dac-192">These behaviors apply to any property (not only store-generated properties) and determine how the value of the property should be used when inserting into a database row (`BeforeSaveBehavior`) or when updating an existing database row (`AfterSaveBehavior`).</span></span>

<span data-ttu-id="f9dac-193">Les propriétés marquées comme [ValueGenerated. OnAddOrUpdate](/dotnet/api/microsoft.entityframeworkcore.metadata.valuegenerated) (par exemple, pour les colonnes calculées) ignorent par défaut toute valeur actuellement définie sur la propriété.</span><span class="sxs-lookup"><span data-stu-id="f9dac-193">Properties marked as [ValueGenerated.OnAddOrUpdate](/dotnet/api/microsoft.entityframeworkcore.metadata.valuegenerated) (for example, for computed columns) will by default ignore any value currently set on the property.</span></span> <span data-ttu-id="f9dac-194">Cela signifie qu’une valeur générée par le magasin sera toujours obtenue, qu’une valeur ait été définie ou modifiée sur l’entité suivie.</span><span class="sxs-lookup"><span data-stu-id="f9dac-194">This means that a store-generated value will always be obtained regardless of whether any value has been set or modified on the tracked entity.</span></span> <span data-ttu-id="f9dac-195">Vous pouvez modifier cette valeur en définissant une `Before\AfterSaveBehavior`différente.</span><span class="sxs-lookup"><span data-stu-id="f9dac-195">This can be changed by setting a different `Before\AfterSaveBehavior`.</span></span>

## <a name="new-clientsetnull-delete-behavior"></a><span data-ttu-id="f9dac-196">Nouveau comportement de suppression de ClientSetNull</span><span class="sxs-lookup"><span data-stu-id="f9dac-196">New ClientSetNull delete behavior</span></span>

<span data-ttu-id="f9dac-197">Dans les versions précédentes, [DeleteBehavior. Restrict](/dotnet/api/microsoft.entityframeworkcore.deletebehavior) avait un comportement pour les entités suivies par le contexte qui correspondait plus à la sémantique `SetNull`.</span><span class="sxs-lookup"><span data-stu-id="f9dac-197">In previous releases, [DeleteBehavior.Restrict](/dotnet/api/microsoft.entityframeworkcore.deletebehavior) had a behavior for entities tracked by the context that more closed matched `SetNull` semantics.</span></span> <span data-ttu-id="f9dac-198">Dans EF Core 2,0, un nouveau comportement de `ClientSetNull` a été introduit comme valeur par défaut pour les relations facultatives.</span><span class="sxs-lookup"><span data-stu-id="f9dac-198">In EF Core 2.0, a new `ClientSetNull` behavior has been introduced as the default for optional relationships.</span></span> <span data-ttu-id="f9dac-199">Ce comportement a des `SetNull` sémantiques pour les entités suivies et le comportement des `Restrict` pour les bases de données créées à l’aide de EF Core.</span><span class="sxs-lookup"><span data-stu-id="f9dac-199">This behavior has `SetNull` semantics for tracked entities and `Restrict` behavior for databases created using EF Core.</span></span> <span data-ttu-id="f9dac-200">Dans notre expérience, il s’agit des comportements les plus attendus/utiles pour les entités suivies et la base de données.</span><span class="sxs-lookup"><span data-stu-id="f9dac-200">In our experience, these are the most expected/useful behaviors for tracked entities and the database.</span></span> <span data-ttu-id="f9dac-201">`DeleteBehavior.Restrict` est désormais respecté pour les entités suivies lorsqu’elles sont définies pour des relations facultatives.</span><span class="sxs-lookup"><span data-stu-id="f9dac-201">`DeleteBehavior.Restrict` is now honored for tracked entities when set for optional relationships.</span></span>

## <a name="provider-design-time-packages-removed"></a><span data-ttu-id="f9dac-202">Packages au moment de la conception du fournisseur supprimés</span><span class="sxs-lookup"><span data-stu-id="f9dac-202">Provider design-time packages removed</span></span>

<span data-ttu-id="f9dac-203">Le package de `Microsoft.EntityFrameworkCore.Relational.Design` a été supprimé.</span><span class="sxs-lookup"><span data-stu-id="f9dac-203">The `Microsoft.EntityFrameworkCore.Relational.Design` package has been removed.</span></span> <span data-ttu-id="f9dac-204">Son contenu a été consolidé en `Microsoft.EntityFrameworkCore.Relational` et `Microsoft.EntityFrameworkCore.Design`.</span><span class="sxs-lookup"><span data-stu-id="f9dac-204">It's contents were consolidated into `Microsoft.EntityFrameworkCore.Relational` and `Microsoft.EntityFrameworkCore.Design`.</span></span>

<span data-ttu-id="f9dac-205">Cela se propage dans les packages au moment de la conception du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="f9dac-205">This propagates into the provider design-time packages.</span></span> <span data-ttu-id="f9dac-206">Ces packages (`Microsoft.EntityFrameworkCore.Sqlite.Design`, `Microsoft.EntityFrameworkCore.SqlServer.Design`, etc.) ont été supprimés et leur contenu est consolidé dans les packages de fournisseurs principaux.</span><span class="sxs-lookup"><span data-stu-id="f9dac-206">Those packages (`Microsoft.EntityFrameworkCore.Sqlite.Design`, `Microsoft.EntityFrameworkCore.SqlServer.Design`, etc.) were removed and their contents consolidated into the main provider packages.</span></span>

<span data-ttu-id="f9dac-207">Pour activer `Scaffold-DbContext` ou `dotnet ef dbcontext scaffold` dans EF Core 2,0, il vous suffit de référencer le package de fournisseur unique :</span><span class="sxs-lookup"><span data-stu-id="f9dac-207">To enable `Scaffold-DbContext` or `dotnet ef dbcontext scaffold` in EF Core 2.0, you only need to reference the single provider package:</span></span>

``` xml
<PackageReference Include="Microsoft.EntityFrameworkCore.SqlServer"
    Version="2.0.0" />
<PackageReference Include="Microsoft.EntityFrameworkCore.Tools"
    Version="2.0.0"
    PrivateAssets="All" />
<DotNetCliToolReference Include="Microsoft.EntityFrameworkCore.Tools.DotNet"
    Version="2.0.0" />
```
