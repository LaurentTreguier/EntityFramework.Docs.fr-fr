---
title: Classements et respect de la casse-EF Core
description: Comment configurer les classements et le respect de la casse dans la base de données et les requêtes
author: roji
ms.date: 04/27/2020
ms.assetid: bde4e0ee-fba3-4813-a849-27049323d301
uid: core/miscellaneous/collations-and-case-sensitivity
ms.openlocfilehash: b3874847922cb39aa57d50813e6e50ff7db72eb9
ms.sourcegitcommit: ebfd3382fc583bc90f0da58e63d6e3382b30aa22
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 06/25/2020
ms.locfileid: "85370563"
---
# <a name="collations-and-case-sensitivity"></a><span data-ttu-id="9af28-103">Classements et respect de la casse</span><span class="sxs-lookup"><span data-stu-id="9af28-103">Collations and Case Sensitivity</span></span>

> [!NOTE]
> <span data-ttu-id="9af28-104">Cette fonctionnalité est introduite dans EF Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="9af28-104">This feature is introduced in EF Core 5.0.</span></span>

<span data-ttu-id="9af28-105">Le traitement de texte dans les bases de données peut être complexe et nécessite plus d’attention à l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="9af28-105">Text processing in databases can be a complex, and requires more user attention that one would suspect.</span></span> <span data-ttu-id="9af28-106">Pour une chose, les bases de données varient considérablement dans la façon dont elles gèrent le texte. par exemple, bien que certaines bases de données respectent la casse par défaut (par exemple, SQLite, PostgreSQL), d’autres ne sont pas sensibles à la casse (SQL Server, MySQL).</span><span class="sxs-lookup"><span data-stu-id="9af28-106">For one thing, databases vary considerably in how they handle text; for example, while some databases are case-sensitive by default (e.g. Sqlite, PostgreSQL), others are case-insensitive (SQL Server, MySQL).</span></span> <span data-ttu-id="9af28-107">En outre, en raison de l’utilisation de l’index, le respect de la casse et les aspects similaires peuvent avoir un impact important sur les performances des requêtes : s’il peut être tentant d’utiliser pour forcer une comparaison ne respectant pas la casse `string.Lower` dans une base de données qui respecte la casse, cela peut empêcher votre application d’utiliser des index.</span><span class="sxs-lookup"><span data-stu-id="9af28-107">In addition, because of index usage, case-sensitivity and similar aspects can have a far-reaching impact on query performance: while it may be tempting to use `string.Lower` to force a case-insensitive comparison in a case-sensitive database, doing so may prevent your application from using indexes.</span></span> <span data-ttu-id="9af28-108">Cette page explique comment configurer le respect de la casse, ou plus généralement, les classements et comment le faire de manière efficace sans compromettre les performances des requêtes.</span><span class="sxs-lookup"><span data-stu-id="9af28-108">This page details how to configure case sensitivity, or more generally, collations, and how to do so in an efficient way without compromising query performance.</span></span>

## <a name="introduction-to-collations"></a><span data-ttu-id="9af28-109">Présentation des classements</span><span class="sxs-lookup"><span data-stu-id="9af28-109">Introduction to collations</span></span>

<span data-ttu-id="9af28-110">Un concept fondamental du traitement du texte est le *classement*, qui est un ensemble de règles déterminant comment les valeurs de texte sont classées et comparées à des fins d’égalité.</span><span class="sxs-lookup"><span data-stu-id="9af28-110">A fundamental concept in text processing is the *collation*, which is a set of rules determining how text values are ordered and compared for equality.</span></span> <span data-ttu-id="9af28-111">Par exemple, bien qu’un classement ne respectant pas la casse ignore les différences entre les lettres majuscules et minuscules dans le cadre de la comparaison d’égalité, le classement qui respecte la casse ne le fait pas.</span><span class="sxs-lookup"><span data-stu-id="9af28-111">For example, while a case-insensitive collation disregards differences between upper- and lower-case letters for the purposes of equality comparison, a case-sensitive collation does not.</span></span> <span data-ttu-id="9af28-112">Toutefois, étant donné que le respect de la casse est dépendant de la culture (par exemple, `i` et `I` représente une lettre différente en turc), il existe plusieurs classements qui ne respectent pas la casse, chacun avec son propre ensemble de règles.</span><span class="sxs-lookup"><span data-stu-id="9af28-112">However, since case-sensitivity is culture-sensitive (e.g. `i` and `I` represent different letter in Turkish), there exist multiple case-insensitive collations, each with its own set of rules.</span></span> <span data-ttu-id="9af28-113">L’étendue des classements s’étend également au-delà du respect de la casse, aux autres aspects des données de caractères. en allemand, par exemple, il est parfois (mais pas toujours) souhaitable de traiter `ä` et `ae` comme identiques.</span><span class="sxs-lookup"><span data-stu-id="9af28-113">The scope of collations also extends beyond case-sensitivity, to other aspects of character data; in German, for example, it is sometimes (but not always) desirable to treat `ä` and `ae` as identical.</span></span> <span data-ttu-id="9af28-114">Enfin, les classements définissent également le mode de *Tri*des valeurs de texte : en Allemand `ä` `a` , le place à la fin de l’alphabet.</span><span class="sxs-lookup"><span data-stu-id="9af28-114">Finally, collations also define how text values are *ordered*: while German places `ä` after `a`, Swedish places it at the end of the alphabet.</span></span>

<span data-ttu-id="9af28-115">Toutes les opérations de texte dans une base de données utilisent un classement, qu’il s’agisse de manière explicite ou implicite, pour déterminer comment l’opération compare et trie les chaînes.</span><span class="sxs-lookup"><span data-stu-id="9af28-115">All text operations in a database use a collation - whether explicitly or implicitly - to determine how the operation compares and orders strings.</span></span> <span data-ttu-id="9af28-116">La liste réelle des classements disponibles et leurs schémas de nommage sont spécifiques à la base de données. consultez [la section ci-dessous](#database-specific-information) pour obtenir des liens vers des pages de documentation pertinentes de différentes bases de données.</span><span class="sxs-lookup"><span data-stu-id="9af28-116">The actual list of available collations and their naming schemes is database-specific; consult [the section below](#database-specific-information) for links to relevant documentation pages of various databases.</span></span> <span data-ttu-id="9af28-117">Heureusement, la base de données permet généralement de définir un classement par défaut au niveau de la base de données ou de la colonne, et de spécifier explicitement le classement à utiliser pour des opérations spécifiques dans une requête.</span><span class="sxs-lookup"><span data-stu-id="9af28-117">Fortunately, database do generally allow a default collation to be defined at the database or column level, and to explicitly specify which collation should be use for specific operations in a query.</span></span>

## <a name="database-collation"></a><span data-ttu-id="9af28-118">Classement de base de données</span><span class="sxs-lookup"><span data-stu-id="9af28-118">Database collation</span></span>

<span data-ttu-id="9af28-119">Dans la plupart des systèmes de base de données, un classement par défaut est défini au niveau de la base de données. à moins d’être remplacé, ce classement s’applique implicitement à toutes les opérations de texte qui se produisent dans cette base de données.</span><span class="sxs-lookup"><span data-stu-id="9af28-119">In most database systems, a default collation is defined at the database level; unless overridden, that collation implicitly applies to all text operations occurring within that database.</span></span> <span data-ttu-id="9af28-120">Le classement de base de données est généralement défini au moment de la création de la base de données (par le biais de l' `CREATE DATABASE` instruction DDL) et, s’il n’est pas spécifié, une valeur de niveau serveur est déterminée par défaut au moment de l’installation.</span><span class="sxs-lookup"><span data-stu-id="9af28-120">The database collation is typically set at database creation time (via the `CREATE DATABASE` DDL statement), and if not specified, defaults to a some server-level value determined at setup time.</span></span> <span data-ttu-id="9af28-121">Par exemple, le classement par défaut au niveau du serveur dans SQL Server est `SQL_Latin1_General_CP1_CI_AS` , qui est un classement qui ne respecte pas la casse et qui respecte les accents.</span><span class="sxs-lookup"><span data-stu-id="9af28-121">For example, the default server-level collation in SQL Server is `SQL_Latin1_General_CP1_CI_AS`, which is a case-insensitive, accent-sensitive collation.</span></span> <span data-ttu-id="9af28-122">Bien que les systèmes de base de données autorisent généralement la modification du classement d’une base de données existante, cela peut entraîner des complications. Il est recommandé de choisir un classement avant la création de la base de données.</span><span class="sxs-lookup"><span data-stu-id="9af28-122">Although database systems usually do permit altering the collation of an existing database, doing so can lead to complications; it is recommended to pick a collation before database creation.</span></span>

<span data-ttu-id="9af28-123">Lors de l’utilisation de EF Core migrations pour gérer votre schéma de base de données, le code suivant dans la méthode de votre modèle `OnModelCreating` configure une base de données SQL Server pour utiliser un classement qui respecte la casse :</span><span class="sxs-lookup"><span data-stu-id="9af28-123">When using EF Core migrations to manage your database schema, the following in your model's `OnModelCreating` method configures a SQL Server database to use a case-sensitive collation:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/Collations/Program.cs?range=40)]

## <a name="column-collation"></a><span data-ttu-id="9af28-124">Classement par colonnes</span><span class="sxs-lookup"><span data-stu-id="9af28-124">Column collation</span></span>

<span data-ttu-id="9af28-125">Les classements peuvent également être définis sur des colonnes de texte, remplaçant la valeur par défaut de la base de données.</span><span class="sxs-lookup"><span data-stu-id="9af28-125">Collations can also be defined on text columns, overriding the database default.</span></span> <span data-ttu-id="9af28-126">Cela peut être utile si certaines colonnes ne doivent pas être sensibles à la casse, tandis que le reste de la base de données doit respecter la casse.</span><span class="sxs-lookup"><span data-stu-id="9af28-126">This can be useful if certain columns need to be case-insensitive, while the rest of the database needs to be case-sensitive.</span></span>

<span data-ttu-id="9af28-127">Lors de l’utilisation de EF Core migrations pour gérer votre schéma de base de données, le code suivant configure la colonne pour `Name` que la propriété ne respecte pas la casse dans une base de données configurée pour respecter la casse :</span><span class="sxs-lookup"><span data-stu-id="9af28-127">When using EF Core migrations to manage your database schema, the following configures the column for the `Name` property to be case-insensitive in a database that is otherwise configured to be case-sensitive:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/Collations/Program.cs?name=OnModelCreating&highlight=6)]

## <a name="explicit-collation-in-a-query"></a><span data-ttu-id="9af28-128">Classement explicite dans une requête</span><span class="sxs-lookup"><span data-stu-id="9af28-128">Explicit collation in a query</span></span>

<span data-ttu-id="9af28-129">Dans certains cas, la même colonne doit être interrogée à l’aide de différents classements par différentes requêtes.</span><span class="sxs-lookup"><span data-stu-id="9af28-129">In some cases, the same column needs to be queried using different collations by different queries.</span></span> <span data-ttu-id="9af28-130">Par exemple, une requête peut être amenée à effectuer une comparaison respectant la casse sur une colonne, alors qu’une autre peut avoir besoin d’effectuer une comparaison qui ne respecte pas la casse sur la même colonne.</span><span class="sxs-lookup"><span data-stu-id="9af28-130">For example, one query may need to perform a case-sensitive comparison on a column, while another may need to perform a case-insensitive comparison on the same column.</span></span> <span data-ttu-id="9af28-131">Cela peut être accompli en spécifiant explicitement un classement dans la requête elle-même :</span><span class="sxs-lookup"><span data-stu-id="9af28-131">This can be accomplished by explicitly specifying a collation within the query itself:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/Collations/Program.cs?name=SimpleQueryCollation)]

<span data-ttu-id="9af28-132">Cela génère une `COLLATE` clause dans la requête SQL, qui applique un classement qui respecte la casse, quel que soit le classement défini au niveau de la colonne ou de la base de données :</span><span class="sxs-lookup"><span data-stu-id="9af28-132">This generates a `COLLATE` clause in the SQL query, which applies a case-sensitive collation regardless of the collation defined at the column or database level:</span></span>

```sql
SELECT [c].[Id], [c].[Name]
FROM [Customers] AS [c]
WHERE [c].[Name] COLLATE SQL_Latin1_General_CP1_CS_AS = N'John'
```

### <a name="explicit-collations-and-indexes"></a><span data-ttu-id="9af28-133">Classements et index explicites</span><span class="sxs-lookup"><span data-stu-id="9af28-133">Explicit collations and indexes</span></span>

<span data-ttu-id="9af28-134">Les index sont l’un des facteurs les plus importants en matière de performances de base de données : une requête qui s’exécute efficacement avec un index peut se broyer à une interruption sans cet index.</span><span class="sxs-lookup"><span data-stu-id="9af28-134">Indexes are one of the most important factors in database performance - a query that runs efficiently with an index can grind to a halt without that index.</span></span> <span data-ttu-id="9af28-135">Les index héritent implicitement du classement de leur colonne ; Cela signifie que toutes les requêtes sur la colonne sont automatiquement éligibles à l’utilisation d’index définis sur cette colonne, à condition que la requête ne spécifie pas un classement différent.</span><span class="sxs-lookup"><span data-stu-id="9af28-135">Indexes implicitly inherit the collation of their column; this means that all queries on the column are automatically eligible to use indexes defined on that column - provided that the query doesn't specify a different collation.</span></span> <span data-ttu-id="9af28-136">La spécification d’un classement explicite dans une requête empêche généralement cette requête d’utiliser un index défini sur cette colonne, car les classements ne correspondent plus. par conséquent, il est recommandé de faire preuve de prudence lors de l’utilisation de cette fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="9af28-136">Specifying an explicit collation in a query will generally prevent that query from using an index defined on that column, since the collations would no longer match; it is therefore recommended to exercise caution when using this feature.</span></span> <span data-ttu-id="9af28-137">Il est toujours préférable de définir le classement au niveau de la colonne (ou de la base de données), ce qui permet à toutes les requêtes d’utiliser implicitement ce classement et de tirer parti de n’importe quel index.</span><span class="sxs-lookup"><span data-stu-id="9af28-137">It is always preferable to define the collation at the column (or database) level, allowing all queries to implicitly use that collation and benefit from any index.</span></span>

<span data-ttu-id="9af28-138">Notez que certaines bases de données permettent de définir le classement lors de la création d’un index (par exemple, PostgreSQL, SQLite).</span><span class="sxs-lookup"><span data-stu-id="9af28-138">Note that some databases allow the collation to be defined when creating an index (e.g. PostgreSQL, Sqlite).</span></span> <span data-ttu-id="9af28-139">Cela permet de définir plusieurs index sur la même colonne, accélérant ainsi les opérations avec des classements différents (par exemple, les comparaisons sensibles à la casse et les comparaisons ne respectant pas la casse).</span><span class="sxs-lookup"><span data-stu-id="9af28-139">This allows multiple indexes to be defined on the same column, speeding up operations with different collations (e.g. both case-sensitive and case-insensitive comparisons).</span></span> <span data-ttu-id="9af28-140">Pour plus d’informations, consultez la documentation de votre fournisseur de base de données.</span><span class="sxs-lookup"><span data-stu-id="9af28-140">Consult your database provider's documentation for more details.</span></span>

> [!WARNING]
> <span data-ttu-id="9af28-141">Inspectez toujours les plans de requête de vos requêtes et assurez-vous que les index appropriés sont utilisés dans les requêtes critiques pour les performances qui s’exécutent sur de grandes quantités de données.</span><span class="sxs-lookup"><span data-stu-id="9af28-141">Always inspect the query plans of your queries, and make sure the proper indexes are being used in performance-critical queries executing over large amounts of data.</span></span> <span data-ttu-id="9af28-142">Le respect de la casse dans une requête via `EF.Functions.Collate` (ou en appelant `string.ToLower` ) peut avoir un impact très important sur les performances de votre application.</span><span class="sxs-lookup"><span data-stu-id="9af28-142">Overriding case-sensitivity in a query via `EF.Functions.Collate` (or by calling `string.ToLower`) can have a very significant impact on your application's performance.</span></span>

## <a name="translation-of-built-in-net-string-operations"></a><span data-ttu-id="9af28-143">Traduction d’opérations de chaînes .NET intégrées</span><span class="sxs-lookup"><span data-stu-id="9af28-143">Translation of built-in .NET string operations</span></span>

<span data-ttu-id="9af28-144">Dans .NET, l’égalité des chaînes respecte la casse par défaut : `s1 == s2` effectue une comparaison ordinale qui requiert que les chaînes soient identiques.</span><span class="sxs-lookup"><span data-stu-id="9af28-144">In .NET, string equality is case-sensitive by default: `s1 == s2` performs an ordinal comparison that requires the strings to be identical.</span></span> <span data-ttu-id="9af28-145">Étant donné que le classement par défaut des bases de données varie et parce qu’il est souhaitable que l’égalité simple utilise des index, EF Core n’effectue aucune tentative de conversion de l’égalité simple en une opération de base de données qui respecte la casse : l’égalité C# est traduite directement en égalité SQL, qui peut ou non respecter la casse, en fonction de la base de données en cours d’utilisation et</span><span class="sxs-lookup"><span data-stu-id="9af28-145">Because the default collation of databases varies, and because it is desirable for simple equality to use indexes, EF Core makes no attempt to translate simple equality to a database case-sensitive operation: C# equality is translated directly to SQL equality, which may or may not be case-sensitive, depending on the specific database in use and its collation configuration.</span></span>

<span data-ttu-id="9af28-146">En outre, .NET fournit des surcharges de [`string.Equals`](https://docs.microsoft.com/dotnet/api/system.string.equals#System_String_Equals_System_String_System_StringComparison_) l’acceptation d’un [`StringComparison`](https://docs.microsoft.com/dotnet/api/system.stringcomparison) enum, ce qui permet de spécifier le respect de la casse et la culture pour la comparaison.</span><span class="sxs-lookup"><span data-stu-id="9af28-146">In addition, .NET provides overloads of [`string.Equals`](https://docs.microsoft.com/dotnet/api/system.string.equals#System_String_Equals_System_String_System_StringComparison_) accepting a [`StringComparison`](https://docs.microsoft.com/dotnet/api/system.stringcomparison) enum, which allows specifying case-sensitivity and culture for the comparison.</span></span> <span data-ttu-id="9af28-147">Par défaut, EF Core s’abstient de traduire ces surcharges en SQL, et la tentative de les utiliser entraînera une exception.</span><span class="sxs-lookup"><span data-stu-id="9af28-147">By design, EF Core refrains from translating these overloads to SQL, and attempting to use them will result in an exception.</span></span> <span data-ttu-id="9af28-148">Pour une chose, EF Core ne sait pas quel classement sensible à la casse ou non sensible à la casse doit être utilisé.</span><span class="sxs-lookup"><span data-stu-id="9af28-148">For one thing, EF Core does know not which case-sensitive or case-insensitive collation should be used.</span></span> <span data-ttu-id="9af28-149">Plus important encore, l’application d’un classement dans la plupart des cas empêche l’utilisation de l’index, ce qui a un impact significatif sur les performances d’une construction .NET très basique et couramment utilisée.</span><span class="sxs-lookup"><span data-stu-id="9af28-149">More importantly, applying a collation would in most cases prevent index usage, significantly impacting performance for a very basic and commonly-used .NET construct.</span></span> <span data-ttu-id="9af28-150">Pour forcer une requête à utiliser une comparaison qui respecte la casse ou qui ne respecte pas la casse, spécifiez explicitement le classement via `EF.Functions.Collate` comme [détaillé ci-dessus](#explicit-collations-and-indexes).</span><span class="sxs-lookup"><span data-stu-id="9af28-150">To force a query to use case-sensitive or case-insensitive comparison, specify a collation explicitly via `EF.Functions.Collate` as [detailed above](#explicit-collations-and-indexes).</span></span>

## <a name="database-specific-information"></a><span data-ttu-id="9af28-151">Informations spécifiques à la base de données</span><span class="sxs-lookup"><span data-stu-id="9af28-151">Database-specific information</span></span>

* <span data-ttu-id="9af28-152">[SQL Server de la documentation sur les classements](https://docs.microsoft.com/sql/relational-databases/collations/collation-and-unicode-support).</span><span class="sxs-lookup"><span data-stu-id="9af28-152">[SQL Server documentation on collations](https://docs.microsoft.com/sql/relational-databases/collations/collation-and-unicode-support).</span></span>
* <span data-ttu-id="9af28-153">[Documentation de Microsoft. Data. sqlite sur les classements](https://docs.microsoft.com/dotnet/standard/data/sqlite/collation).</span><span class="sxs-lookup"><span data-stu-id="9af28-153">[Microsoft.Data.Sqlite documentation on collations](https://docs.microsoft.com/dotnet/standard/data/sqlite/collation).</span></span>
* <span data-ttu-id="9af28-154">[Documentation PostgreSQL sur les classements](https://www.postgresql.org/docs/current/collation.html).</span><span class="sxs-lookup"><span data-stu-id="9af28-154">[PostgreSQL documentation on collations](https://www.postgresql.org/docs/current/collation.html).</span></span>
* <span data-ttu-id="9af28-155">[Documentation MySQL sur les classements](https://dev.mysql.com/doc/refman/en/charset-general.html).</span><span class="sxs-lookup"><span data-stu-id="9af28-155">[MySQL documentation on collations](https://dev.mysql.com/doc/refman/en/charset-general.html).</span></span>
