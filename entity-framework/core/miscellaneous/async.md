---
title: Programmation asynchrone-EF Core
description: Interrogation et enregistrement de données de façon asynchrone avec Entity Framework Core
author: roji
ms.date: 9/2/2020
uid: core/miscellaneous/async
ms.openlocfilehash: 78c109e9fd73dbb0451f9e29562799e4d22d66c9
ms.sourcegitcommit: 704240349e18b6404e5a809f5b7c9d365b152e2e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/16/2021
ms.locfileid: "100543352"
---
# <a name="asynchronous-programming"></a><span data-ttu-id="99eef-103">Programmation asynchrone</span><span class="sxs-lookup"><span data-stu-id="99eef-103">Asynchronous Programming</span></span>

<span data-ttu-id="99eef-104">Les opérations asynchrones évitent de bloquer un thread pendant que la requête est exécutée dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="99eef-104">Asynchronous operations avoid blocking a thread while the query is executed in the database.</span></span> <span data-ttu-id="99eef-105">Les opérations asynchrones sont importantes pour conserver une interface utilisateur réactive dans des applications clientes riches, et peuvent également augmenter le débit dans les applications Web où elles libèrent le thread pour traiter d’autres requêtes dans des applications Web.</span><span class="sxs-lookup"><span data-stu-id="99eef-105">Async operations are important for keeping a responsive UI in rich client applications, and can also increase throughput in web applications where they free up the thread to service other requests in web applications.</span></span>

<span data-ttu-id="99eef-106">À la suite de .NET standard, EF Core fournit des équivalents asynchrones à toutes les méthodes synchrones qui effectuent des e/s.</span><span class="sxs-lookup"><span data-stu-id="99eef-106">Following the .NET standard, EF Core provides asynchronous counterparts to all synchronous methods which perform I/O.</span></span> <span data-ttu-id="99eef-107">Celles-ci ont les mêmes effets que les méthodes de synchronisation et peuvent être utilisées avec `async` les `await` Mots clés C# et.</span><span class="sxs-lookup"><span data-stu-id="99eef-107">These have the same effects as the sync methods, and can be used with the C# `async` and `await` keywords.</span></span> <span data-ttu-id="99eef-108">Par exemple, au lieu d’utiliser DbContext. SaveChanges, qui bloque un thread pendant l’exécution des e/s de la base de données, DbContext. SaveChangesAsync peut être utilisé :</span><span class="sxs-lookup"><span data-stu-id="99eef-108">For example, instead of using DbContext.SaveChanges, which will block a thread while database I/O is performed, DbContext.SaveChangesAsync can be used:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/Async/Program.cs#SaveChangesAsync)]

<span data-ttu-id="99eef-109">Pour plus d’informations, consultez [les documents généraux sur la programmation asynchrone en C#](/dotnet/csharp/async).</span><span class="sxs-lookup"><span data-stu-id="99eef-109">For more information, see [the general C# asynchronous programming docs](/dotnet/csharp/async).</span></span>

> [!WARNING]
> <span data-ttu-id="99eef-110">EF Core ne prend pas en charge l’exécution de plusieurs opérations parallèles sur la même instance de contexte.</span><span class="sxs-lookup"><span data-stu-id="99eef-110">EF Core doesn't support multiple parallel operations being run on the same context instance.</span></span> <span data-ttu-id="99eef-111">Vous devez toujours attendre qu’opération se termine avant de commencer l’opération suivante.</span><span class="sxs-lookup"><span data-stu-id="99eef-111">You should always wait for an operation to complete before beginning the next operation.</span></span> <span data-ttu-id="99eef-112">Cela s’effectue généralement en utilisant le `await` mot clé sur chaque opération asynchrone.</span><span class="sxs-lookup"><span data-stu-id="99eef-112">This is typically done by using the `await` keyword on each async operation.</span></span>

> [!WARNING]
> <span data-ttu-id="99eef-113">L’implémentation Async de [Microsoft. Data. SqlClient](https://github.com/dotnet/SqlClient) présente malheureusement des problèmes connus (par exemple, [#593](https://github.com/dotnet/SqlClient/issues/593), [#601](https://github.com/dotnet/SqlClient/issues/601)et d’autres).</span><span class="sxs-lookup"><span data-stu-id="99eef-113">The async implementation of [Microsoft.Data.SqlClient](https://github.com/dotnet/SqlClient) unfortunately has some known issues (e.g. [#593](https://github.com/dotnet/SqlClient/issues/593), [#601](https://github.com/dotnet/SqlClient/issues/601), and others).</span></span>

> [!NOTE]
> <span data-ttu-id="99eef-114">EF Core passe des jetons d’annulation au fournisseur de base de données sous-jacent en cours d’utilisation (par exemple, Microsoft. Data. SqlClient).</span><span class="sxs-lookup"><span data-stu-id="99eef-114">EF Core passes cancellation tokens down to the underlying database provider in use (e.g. Microsoft.Data.SqlClient).</span></span> <span data-ttu-id="99eef-115">Ces jetons peuvent être ou non honorés-consultez la documentation de votre fournisseur de base de données.</span><span class="sxs-lookup"><span data-stu-id="99eef-115">These tokens may or may not be honored - consult your database provider's documentation.</span></span>

## <a name="async-linq-operators"></a><span data-ttu-id="99eef-116">Opérateurs LINQ asynchrones</span><span class="sxs-lookup"><span data-stu-id="99eef-116">Async LINQ operators</span></span>

<span data-ttu-id="99eef-117">Pour prendre en charge l’exécution de requêtes LINQ de manière asynchrone, EF Core fournit un ensemble de méthodes d’extension Async qui exécutent la requête et retournent des résultats.</span><span class="sxs-lookup"><span data-stu-id="99eef-117">In order to support executing LINQ queries asynchronously, EF Core provides a set of async extension methods which execute the query and return results.</span></span> <span data-ttu-id="99eef-118">Ces équivalents aux opérateurs LINQ standard et synchrones sont ToListAsync, SingleAsync, AsAsyncEnumerable, etc. :</span><span class="sxs-lookup"><span data-stu-id="99eef-118">These counterparts to the standard, synchronous LINQ operators include ToListAsync, SingleAsync, AsAsyncEnumerable, etc.:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/Async/Program.cs#ToListAsync)]

<span data-ttu-id="99eef-119">Notez qu’il n’existe aucune version asynchrone de certains opérateurs LINQ, tels que Where ou OrderBy, car ils génèrent uniquement l’arborescence de l’expression LINQ et n’entraînent pas l’exécution de la requête dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="99eef-119">Note that there are no async versions of some LINQ operators such as Where or OrderBy, because these only build up the LINQ expression tree and don't cause the query to be executed in the database.</span></span> <span data-ttu-id="99eef-120">Seuls les opérateurs qui entraînent l’exécution de la requête ont des équivalents asynchrones.</span><span class="sxs-lookup"><span data-stu-id="99eef-120">Only operators which cause query execution have async counterparts.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="99eef-121">Les méthodes d’extension EF Core asynchrones sont définies dans l’espace de noms `Microsoft.EntityFrameworkCore`.</span><span class="sxs-lookup"><span data-stu-id="99eef-121">The EF Core async extension methods are defined in the `Microsoft.EntityFrameworkCore` namespace.</span></span> <span data-ttu-id="99eef-122">Cet espace de noms doit être importé pour que les méthodes soient disponibles.</span><span class="sxs-lookup"><span data-stu-id="99eef-122">This namespace must be imported for the methods to be available.</span></span>

## <a name="client-side-async-linq-operators"></a><span data-ttu-id="99eef-123">Opérateurs LINQ Async côté client</span><span class="sxs-lookup"><span data-stu-id="99eef-123">Client-side async LINQ operators</span></span>

<span data-ttu-id="99eef-124">Les opérateurs LINQ asynchrones décrits ci-dessus ne peuvent être utilisés que sur des requêtes EF. vous ne pouvez pas les utiliser avec une requête de LINQ to Objects côté client.</span><span class="sxs-lookup"><span data-stu-id="99eef-124">The async LINQ operators discussed above can only be used on EF queries - you cannot use them with client-side LINQ to Objects query.</span></span> <span data-ttu-id="99eef-125">Pour effectuer des opérations LINQ asynchrones côté client en dehors d’EF, utilisez le [package System. Linq. Async.](https://www.nuget.org/packages/System.Linq.Async) Ce package peut être particulièrement utile pour effectuer des opérations sur le client qui ne peuvent pas être traduites à des fins d’évaluation sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="99eef-125">To perform client-side async LINQ operations outside of EF, use the [System.Linq.Async package](https://www.nuget.org/packages/System.Linq.Async); this package can be especially useful for performing operations on the client that cannot be translated for evaluation at the server.</span></span>

<span data-ttu-id="99eef-126">Malheureusement, la référencement de System. interactive. Async provoque des erreurs de compilation d’appel ambigu sur les opérateurs LINQ appliqués au DbSets d’EF. Cela rend difficile l’utilisation à la fois d’EF et de System. interactive. Async dans le même projet.</span><span class="sxs-lookup"><span data-stu-id="99eef-126">Unfortunately, referencing System.Interactive.Async causes ambiguous invocation compilation errors on LINQ operators applied to EF's DbSets; this makes it hard to use both EF and System.Interactive.Async in the same project.</span></span> <span data-ttu-id="99eef-127">Pour contourner ce problème, ajoutez AsQueryable à votre DbSet :</span><span class="sxs-lookup"><span data-stu-id="99eef-127">To work around this issue, add AsQueryable to your DbSet:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/AsyncWithSystemInteractive/Program.cs#SystemInteractiveAsync)]
